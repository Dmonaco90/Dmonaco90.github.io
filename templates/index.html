<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    
    
</head>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>



<body>


<button id="btnMostraCarrello">
    <i class="fa fa-shopping-cart"></i>
    <span id="conteggioCarrello" class="badge">0</span>
</button>

<div class="input-container">
    <input type="text" id="nome_cliente" placeholder="Nome Cliente">
    <input type="text" id="riferimento_ordine" placeholder="Riferimento Ordine">
  
</div>


<div class="profile-section" id="profile-section">
    <h2>Scegli Profilo</h2>
    <div class="profile-grid">
        <!-- Ripeti questo blocco per 30 volte, cambia l'URL dell'immagine di sfondo per ciascun quadrato -->
        <div class="profile" style="background-image: url('static/img/zeta2.png');" data-target="zeta"></div>
        <div class="profile" style="background-image: url('static/img/omega.png');"data-target="omega"></div>
        <div class="profile" style="background-image: url('static/img/Ami.png');"data-target="Ami"></div>
        <div class="profile" style="background-image: url('static/img/Amo.png');"data-target="Amo"></div>
        <div class="profile" style="background-image: url('static/img/gancio.png');"data-target="gancio"></div>
        <div class="profile" style="background-image: url('static/img/L.png');"data-target="L"></div>
        <div class="profile" style="background-image: url('static/img/OmegaAsi.png');" data-target="OmegaAsi"></div>
        <div class="profile" style="background-image: url('static/img/OmegaInt.png');"data-target="OmegaInt"></div>
        <div class="profile" style="background-image: url('static/img/OmegaIntAsi.png');"data-target="OmegaIntAsi"></div>
        <div class="profile" style="background-image: url('static/img/u.png');"data-target="u"></div>
        <div class="profile" style="background-image: url('static/img/Linea.png');"data-target="Linea"></div>
        <div class="profile" style="background-image: url('static/img/OmegaAsi2.png');" data-target="OmegaAsi2"></div>
        <div class="profile" style="background-image: url('static/img/LineaAngolare.png');"data-target="LineaAngolare"></div>
        <div class="profile" style="background-image: url('static/img/omega5.png');"data-target="omega5"></div>
        <div class="profile" style="background-image: url('static/img/L45.png');"data-target="L45"></div>
        <div class="profile" style="background-image: url('static/img/Freccia.png');"data-target="Freccia"></div>
        <div class="profile" style="background-image: url('static/img/P.png');"data-target="P"></div>
        <div class="profile" style="background-image: url('static/img/P_rovescia.png');"data-target="P_rovescia"></div>
        <div class="profile" style="background-image: url('static/img/Scatola.png');"data-target="Scatola"></div>
        <div class="profile" id="libero"style="background-image: url('static/img/libero.png');"data-target="libero"></div>
        <div class="profile" id="addProfile"style="background-image: url('static/img/addProfile.png');"data-target="addProfile"></div>
    </div>
</div>


<div class="measure-section2" id="measureSection">
    <div class="flex-container flex-container-addProfile">
        
        <div class="measure-section addProfile" id="drawSection">
          
            <div id="containerInputControllo"> <!-- Contenitore per le input di controllo -->
                <!-- Le input di controllo verranno aggiunte qui -->
            </div>
            <div id="containerInputImmagini">
                <!-- Gli input di controllo verranno aggiunti qui -->
            </div>
            <div id="listaSviluppo" style="display: none;"> <!-- Contenitore nascosto inizialmente -->
                <!-- La lista e le input box verranno generate qui -->
            </div>


            <div class="image-container addProfile">
                <img id="imagePreview" src="static/img/addProfile2.png" alt="addProfile">
                <button id="uploadButton">Carica Profilo</button>
                <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                <input type="number" id="numeroQuote" placeholder="N. quote">
                <button id="datiSviluppoButton">Dati Sviluppo</button> <!-- Pulsante aggiunto qui -->
                <button id="versoVerniciatura">Versi Verniciatura</button> <!-- Pulsante aggiunto qui -->
                <button id="saveProfileButton">Salva Profilo</button>
                <div id="containerInputQuote"> <!-- Contenitore per le input quote -->
                    <!-- Le input quote verranno aggiunte qui -->
                </div>
                <div class="image-container">
                  
                </div>
                
            </div>
        </div>
   

        <div class="measure-section zeta" id="drawSection">
            <div class="image-container zeta">
                <img src="static/img/zeta2.png" alt="zeta">
                <input type="number" class="input-lato lato-zeta" id="lato1-zeta" style="top: 8%; left: 10%;   " placeholder="x">
                <input type="number" class="input-lato lato-zeta" id="lato2-zeta" style="top: 82%; left: 69%;  " placeholder="x">
                <input type="number" class="input-lato lato-zeta" id="lato3-zeta" style="top: 47%; right: 52%;  " placeholder="x">
                <div class="scelteVerniciato" style="display: none;">
                    <img src="static/img/freccia_interna.png" class="opzioneVerniciato" id="scelta1" style="position: absolute;  margin: 0; width: auto; top: 63%; left: 50%;">
                    <img src="static/img/freccia_esterna.png" class="opzioneVerniciato" id="scelta2" style="position: absolute;  margin: 0; width: auto; top: 27%; left: 37%;">
                 </div>
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section u" id="drawSection">
            <div class="image-container u">
                <img src="static/img/u.png" alt="u">
                <input type="number" class="input-lato lato-u" id="lato1-u" style="top: 45%; left: 12%;  " placeholder="x">
                <input type="number" class="input-lato lato-u" id="lato2-u" style="top: 65%; left: 50%;  " placeholder="x">
                <input type="number" class="input-lato lato-u" id="lato3-u" style="top: 45%; right: 1%;  " placeholder="x">
                <div class="scelteVerniciato" style="display: none;">
                    <img src="static/img/freccia_interna.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 47%; left: 30%;">
                    <img src="static/img/freccia_esterna.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 58%; left: 18%;">
                 </div>
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section omega5" id="drawSection">
            <div class="image-container omega5">
                <img src="static/img/omega5.png" alt="u">
                <input type="number" class="input-lato lato-omega5" id="lato1-Omega5" style="top: 25%; left: 25%;  " placeholder="x">
                <input type="number" class="input-lato lato-omega5" id="lato1-Omega5" style="top: 25%; right: 13%;  " placeholder="x">
                <input type="number" class="input-lato lato-Omega5" id="lato2-Omega5" style="top: 75%; left: 47%;  " placeholder="x">
                <input type="number" class="input-lato lato-Omega5" id="lato3-Omega5" style="top: 59%; right: 10%;  " placeholder="x">
                <input type="number" class="input-lato lato-Omega5" id="lato3-Omega5" style="top: 59%; left: 10%;  " placeholder="x">
                <input type="number" class="input-lato lato-Omega5" id="lato3-Omega5" style="top: 64%; right: 23%;   text-align:center;" placeholder="x">
                <input type="number" class="input-lato lato-Omega5" id="lato3-Omega5" style="top: 64%; left: 20%;  text-align:right;" placeholder="x">
                <input type="number" class="input-lato lato-Omega5" id="lato3-Omega5" style="top: 40%; left: -1%;  text-align:right;" placeholder="x">
                <input type="number" class="input-lato lato-Omega5" id="lato3-Omega5" style="top: 40%; right: -1%;  " placeholder="x">
                <div class="scelteVerniciato" style="display: none;">
                    <img src="static/img/freccia_interna.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 22%; left: 83%;">
                    <img src="static/img/freccia_esterna.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 35%; left: 69%;">
                 </div>
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section LineaAngolare" id="drawSection">
            <div class="image-container LineaAngolare">
                <img src="static/img/LineaAngolare.png" alt="u">
                <input type="number" class="input-lato lato-LineaAngolare" id="lato1-LineaAngolare" style="top: 43%; right: 29%;  " placeholder="x">
                <input type="number" class="input-lato lato-LineaAngolare" id="lato2-LineaAngolare" style="top: 48%; left: 42%;  " placeholder="x">
                 <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
                 <div class="scelteVerniciato" style="display: none;">
                    <img src="static/img/freccia_interna2.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 41%; left: 25%;">
                    <img src="static/img/freccia_esterna2.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 59%; left: 58%;">
                 </div>
            </div>
        </div>

        <div class="measure-section OmegaAsi2" id="drawSection">
            <div class="image-container OmegaAsi2">
                <img src="static/img/OmegaAsi2.png" alt="u">
                <input type="number" class="input-lato lato-OmegaAsi2" id="lato1-OmegaAsi2" style="top: 32%; right: 8%;  " placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi2" id="lato2-OmegaAsi2" style="top: 43%; right: 22%;  text-align: right;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi2" id="lato3-OmegaAsi2" style="top: 69%; right: 0%;  " placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi2" id="lato1-OmegaAsi2" style="top: 68%; left: 9%;  " placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi2" id="lato2-OmegaAsi2" style="top: 83%; left: 47%;  " placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi2" id="lato3-OmegaAsi2" style="top: 55%; right: 18%;  " placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi2" id="lato3-OmegaAsi2" style="top: 18%; right: 9%;  " placeholder="x">
                <div class="scelteVerniciato" style="display: none;">
                    <img src="static/img/freccia_interna2.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 65%; left: 25%;">
                    <img src="static/img/freccia_esterna2.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 81%; left: 58%;">
                 </div>
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section L" id="drawSection">
            <div class="image-container L">
                <img src="static/img/L.png" alt="L">

                <input type="number" class="input-lato lato-L" id="lato2-L" style="top: 50%; left: 6%;  " placeholder="x">
                <input type="number" class="input-lato lato-L" id="lato3-L" style="top: 75%; right: 35%;  " placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
                <div class="scelteVerniciato" style="display: none;">
                    <img src="static/img/freccia_interna.png" class="opzioneVerniciato" id="scelta111" style="position: absolute;  margin: 0; width: auto; top: 46%; left: 31%;">
                    <img src="static/img/freccia_esterna.png" class="opzioneVerniciato" id="scelta222" style="position: absolute;  margin: 0; width: auto; top: 57%; left: 19%;">
                 </div>

            </div>
        </div>

        <div class="measure-section Linea" id="drawSection">
            <div class="image-container Linea">
                <img src="static/img/Linea.png" alt="Linea">

                <input type="number" class="input-lato lato-Linea" id="lato2-Linea" style="top: 40%; left: 50%;  " placeholder="x">

                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section omega" id="drawSection">
            <div class="image-container omega">
                <img src="static/img/omega.png" alt="omega">
                <input type="number" class="input-lato lato-omega" id="lato1-omega" style="top: 20%; left: 10%;  " placeholder="x">
                <input type="number" class="input-lato lato-omega" id="lato2-omega" style="top: 75%; left: 52%;  " placeholder="x">
                <input type="number" class="input-lato lato-omega" id="lato3-omega" style="top: 20%; right: 5%;  " placeholder="x">
                <input type="number" class="input-lato lato-omega" id="lato4-omega" style="top: 50%; right: 7%;  " placeholder="x">
                <input type="number" class="input-lato lato-omega" id="lato5-omega" style="top: 50%; left: 22%;  " placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
                <div class="scelteVerniciato" style="display: none;">
                    <img src="static/img/freccia_interna.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 52%; left: 35%;">
                    <img src="static/img/freccia_esterna.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 64%; left: 22%;">
                 </div>
            </div>
        </div>

        <div class="measure-section OmegaAsi" id="drawSection">
            <div class="image-container OmegaAsi">
                <img src="static/img/OmegaAsi.png" alt="u">
                <input type="number" class="input-lato lato-OmegaAsi" id="lato1-OmegaAsi" style="top: 12%; left: 38%;  " placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi" id="lato2-OmegaAsi" style="top: 80%; left: 38%;  " placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi" id="lato3-OmegaAsi" style="top: 61%; right: 1%;  " placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi" id="lato4-OmegaAsi" style="top: 47%; left: 15%;  " placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi" id="lato5-OmegaAsi" style="top: 61%; left: 54%;  " placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi" id="lato6-OmegaAsi" style="top: 30%; right: 30%;  " placeholder="x">
                <div class="scelteVerniciato" style="display: none;">
                    <img src="static/img/freccia_interna.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 56%; left: 38%;">
                    <img src="static/img/freccia_esterna.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 68%; left: 26%;">
                 </div>
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section OmegaInt" id="drawSection">
            <div class="image-container OmegaInt">
                <img src="static/img/OmegaInt.png" alt="OmegaInt">
                <input type="number" class="input-lato lato-OmegaInt" id="lato1-OmegaInt" style="top: 25%; left: 20%;  " placeholder="x">
                <input type="number" class="input-lato lato-OmegaInt" id="lato2-OmegaInt" style="top: 80%; left: 50%;  " placeholder="x">
                <input type="number" class="input-lato lato-OmegaInt" id="lato3-OmegaInt" style="top: 25%; right: 15%;  " placeholder="x">
                <input type="number" class="input-lato lato-OmegaInt" id="lato4-OmegaInt" style="top: 50%; right: -1%;  " placeholder="x">
                <input type="number" class="input-lato lato-OmegaInt" id="lato5-OmegaInt" style="top: 50%; left: 3%;  " placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
                <div class="scelteVerniciato" style="display: none;">
                    <img src="static/img/freccia_interna.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 56%; left: 27%;">
                    <img src="static/img/freccia_esterna.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 67%; left: 16%;">
                 </div>
            </div>
        </div>

        <div class="measure-section OmegaIntAsi" id="drawSection">
            <div class="image-container OmegaIntAsi">
                <img src="static/img/OmegaIntAsi.png" alt="OmegaIntAsi">
                <input type="number" class="input-lato lato-OmegaIntAsi" id="lato1-OmegaIntAsi" style="top: 17%; left: 35%;  " placeholder="x">
                <input type="number" class="input-lato lato-OmegaIntAsi" id="lato2-OmegaIntAsi" style="top: 80%; left: 50%;  " placeholder="x">
                <input type="number" class="input-lato lato-OmegaIntAsi" id="lato3-OmegaIntAsi" style="top: 34%; right: 15%;  " placeholder="x">
                <input type="number" class="input-lato lato-OmegaIntAsi" id="lato4-OmegaIntAsi" style="top: 50%; right: -1%;  " placeholder="x">
                <input type="number" class="input-lato lato-OmegaIntAsi" id="lato5-OmegaIntAsi" style="top: 50%; left: 3%;  " placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
                <div class="scelteVerniciato" style="display: none;">
                    <img src="static/img/freccia_interna.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 56%; left: 27%;">
                    <img src="static/img/freccia_esterna.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 67%; left: 16%;">
                 </div>
            </div>
        </div>

        <div class="measure-section Scatola" id="drawSection">
            <div class="image-container Scatola">
                <img src="static/img/Scatola.png" alt="Scatola">
                <input type="number" class="input-lato lato-Scatola" id="lato1-Scatola" style="top: 63%; left: 5%;  " placeholder="x">
                <input type="number" class="input-lato lato-Scatola" id="lato2-Scatola" style="top: 81%; left: 34%;  " placeholder="x">
                <input type="number" class="input-lato lato-Scatola" id="lato3-Scatola" style="top: 69%; left: 67%;  " placeholder="x">
                <input type="number" class="input-lato lato-Scatola" id="lato4-Scatola" style="top: 56%; right: 3%;  " placeholder="x">
                <input type="number" class="input-lato lato-Scatola" id="lato5-Scatola" style="top: 24%; right: -6%;  " placeholder="x">
                <input type="number" class="input-lato lato-Scatola" id="lato5-Scatola" style="top: 24%; left: 23%;  " placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
                <div class="scelteVerniciato" style="display: none;">
                    <img src="static/img/freccia_interna.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 72%; left: 27%;">
                    <img src="static/img/freccia_esterna.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 81%; left: 16%;">
                 </div>
            </div>
        </div>

        <div class="measure-section Amo" id="drawSection">
            <div class="image-container Amo">
                <img src="static/img/Amo.png" alt="Amo">
                <input type="number" class="input-lato lato-Amo" id="lato1-Amo" style="top: 32%; left: 15%;  " placeholder="x">
                <input type="number" class="input-lato lato-Amo" id="lato2-Amo" style="top: 65%; left: 50%;  " placeholder="x">
                <div class="scelteVerniciato" style="display: none;">
                    <img src="static/img/freccia_interna.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 44%; left: 34%;">
                    <img src="static/img/freccia_esterna.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 55%; left: 24%;">
                 </div>
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section Ami" id="drawSection">
            <div class="image-container Ami">
                <img src="static/img/Ami.png" alt="Ami">
                <input type="number" class="input-lato lato-Ami" id="lato1-Ami" style="top: 32%; left: 22%;  " placeholder="x">
                <input type="number" class="input-lato lato-Ami" id="lato2-Ami" style="top: 60%; left: 48%;  " placeholder="x">
                <input type="number" class="input-lato lato-Ami" id="lato3-Ami" style="top: 32%; right: 18%;  " placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
                <div class="scelteVerniciato" style="display: none;">
                    <img src="static/img/freccia_interna2.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 41%; left: 36%;">
                    <img src="static/img/freccia_esterna2.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 57%; left: 51%;">
                 </div>
            </div>
        </div>

        <div class="measure-section gancio" id="drawSection">
            <div class="image-container gancio">
                <img src="static/img/gancio.png" alt="gancio">
                <input type="number" class="input-lato lato-gancio" id="lato1-gancio" style="top: 28%; left: 30%;  " placeholder="x">
                <input type="number" class="input-lato lato-gancio" id="lato2-gancio" style="top: 70%; left: 50%;  " placeholder="x">
                <input type="number" class="input-lato lato-gancio" id="lato3-gancio" style="top: 50%; left: 15%;  " placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
                <div class="scelteVerniciato" style="display: none;">
                    <img src="static/img/freccia_interna.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 46%; left: 32%;">
                    <img src="static/img/freccia_esterna.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 58%; left: 16%;">
                 </div>
            </div>
        </div>

        <div class="measure-section P_rovescia" id="drawSection">
            <div class="image-container P_rovescia">
                <img src="static/img/P_rovescia.png" alt="P_rovescia">
                <input type="number" class="input-lato lato-P_rovescia" id="lato1-P_rovescia" style="top: 32%; left: 50%;  " placeholder="x">
                <input type="number" class="input-lato lato-P_rovescia" id="lato2-P_rovescia" style="top: 69%; left: 61%;  " placeholder="x">
                <input type="number" class="input-lato lato-P_rovescia" id="lato3-P_rovescia" style="top: 43%; left: 25%;  " placeholder="x">
                <input type="number" class="input-lato lato-P_rovescia" id="lato4-P_rovescia" style="top: 50%; left: 70%;  " placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
                <div class="scelteVerniciato" style="display: none;">
                    <img src="static/img/freccia_interna.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 31%; left: 68%;">
                    <img src="static/img/freccia_esterna.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 43%; left: 55%;">
                 </div>
            </div>
        </div>

        <div class="measure-section P" id="drawSection">
            <div class="image-container P">
                <img src="static/img/P.png" alt="P">
                <input type="number" class="input-lato lato-P" id="lato1-P" style="top: 25%; left: 37%;  " placeholder="x">
                <input type="number" class="input-lato lato-P" id="lato2-P" style="top: 61%; left: 45%;  " placeholder="x">
                <input type="number" class="input-lato lato-P" id="lato3-P" style="top: 43%; left: 24%;  " placeholder="x">
                <input type="number" class="input-lato lato-P" id="lato3-P" style="top: 34%; left: 47%;  " placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
                <div class="scelteVerniciato" style="display: none;">
                    <img src="static/img/freccia_interna.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 46%; left: 32%;">
                    <img src="static/img/freccia_esterna.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 58%; left: 16%;">
                 </div>
            </div>
        </div>

        <div class="measure-section Freccia" id="drawSection">
            <div class="image-container Freccia">
                <img src="static/img/Freccia.png" alt="Freccia">

                <input type="number" class="input-lato lato-Freccia" id="lato2-Freccia" style="top: 62%; left: 50%;  " placeholder="x">
                <input type="number" class="input-lato lato-Freccia" id="lato3-Freccia" style="top: 44%; left: 20%;  " placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
                <div class="scelteVerniciato" style="display: none;">
                    <img src="static/img/freccia_interna.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 46%; left: 32%;">
                    <img src="static/img/freccia_esterna.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 58%; left: 16%;">
                 </div>
            </div>
        </div>

        <div class="measure-section L45" id="drawSection">
            <div class="image-container L45">
                <img src="static/img/L45.png" alt="L45">
             
                <input type="number" class="input-lato lato-Freccia" id="lato2-Freccia" style="top: 62%; left: 50%;  " placeholder="x">
                <input type="number" class="input-lato lato-Freccia" id="lato3-Freccia" style="top: 44%; left: 20%;  " placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
                <div class="scelteVerniciato" style="display: none;">
                    <img src="static/img/freccia_interna.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 46%; left: 32%;">
                    <img src="static/img/freccia_esterna.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 58%; left: 16%;">
                 </div>
            </div>
        </div>

        <div class="measure-section libero" id="drawSection">
            <div class="image-container libero" id="drawSection-libero">
                
                <div id="toolbar">
                    <button id="pencil"><i class="fa fa-pencil-alt"></i></button>
                    <button id="eraser"><i class="fa fa-trash"></i></button>
                    <button id="dimension">Quota</button>
                    <!--<button id="deleteDimensions"><i class="fa fa-trash"></i></button>-->
                    <button id="eraserTool" title="Undo"><i class="fa fa-undo"></i></button>
                    <button id="refresh" title="refresh"><i class="fa fa-save" aria-hidden="true"></i></button>
                
                </div>
                <div id="drawingCanvasParent" style="position: relative;">
                    <canvas id="drawingCanvas" ></canvas>
                </div>
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
                
            </div>
        </div>
        
        
        <div class="dropdown-container">
            <input type="text"  class="riferimento" id="riferimento"  placeholder="Riferimento">
            <div class="dropdown-menus">
                <select id="materiale" class="dropdown">
                    <option value="" disabled selected hidden>Materiale</option>
                    <option value="Alluminio">Alluminio</option>
                    <option value="Ferro">Ferro</option>
                    <option value="Acciaio">Acciaio</option>
                    <option value="PVC">PVC</option>
                </select>
            </div>
            <div class="dropdown-menus">
                <select id="tipologia" class="dropdown" disabled>
                    <option value="" disabled selected hidden>Tipologia</option>
                </select>
            </div>
            <div class="dropdown-menus">
                <select id="spessore" class="dropdown" disabled>
                    <option value="" disabled selected hidden>Spessore</option>
                </select>
            </div>
            <div class="dropdown-menus">
                <select id="colore" class="dropdown" disabled>
                    <option value="" disabled selected hidden>Colore</option>
                </select>
            </div>
        </div>
    </div>
    


    <div class="input-section" id="input-section">
        
            <input type="number"  class="input-section2" id="numPezzi"  placeholder="N. Pezzi">
            <input type="number"  class="input-section2" id="altezza"  placeholder="Altezza">
            <button id="btnAggiungiCarrello" class="input-section2">Aggiungi al Carrello</button>
           
     
    </div>
</div>
<div class="risultatiSviluppo" id="risultatiSviluppo" style="display: none;">
  
    <button id="btnTornaIndietro">Torna Indietro</button>
    <button id="btnProsegui">Prosegui</button>
</div>

<div id="dettagliCarrello" style="display: none;">
    <h2>Contenuto del Carrello</h2>
    <div id="elementiCarrello">
        <!-- Dettagli degli elementi del carrello qui -->
    </div>
    <button id="btnAggiungiElementi">Aggiungi Altro</button>
      <!--  <button id="downloadButton">Scarica Ordine</button>-->
    <button id="sendEmailButton">Invia Ordine</button>
    <button id="btnSviluppo">Sviluppo</button> 
</div>

<footer>
    <p>&copy; 2024 Daniele Monaco</p>
    <p><a href="/templates/termini-di-servizio.html" target="_blank">Termini di Servizio</a></p>
</footer>



<script>

    // Array globale per memorizzare le input box di controllo
    let imageControlInputs = [];
    let ArrControlInputs = [];
    const controlInputsById = {};
    let isDatiSviluppoCreated = false;
    let scalatureData = {};

    document.getElementById('uploadButton').addEventListener('click', function() {
        document.getElementById('imageUpload').click();
    });

    document.getElementById('imageUpload').addEventListener('change', function(event) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const imgElement = document.getElementById('imagePreview');
            imgElement.src = e.target.result;
        };
        reader.readAsDataURL(event.target.files[0]);
    });

    document.getElementById('numeroQuote').addEventListener('change', function() {
        const numQuote = this.value;
        const containerInputQuote = document.getElementById('containerInputQuote');
        const containerInputControllo = document.getElementById('containerInputControllo');
        const containerInputImmagini = document.getElementById('containerInputImmagini');
        containerInputImmagini.style.display = 'none';
        const listaSviluppo = document.getElementById('listaSviluppo');
        listaSviluppo.style.display = 'none';
    
        // Pulisci entrambi i contenitori
        containerInputQuote.innerHTML = '';
        containerInputControllo.innerHTML = '';
    
        // Calcola le percentuali e crea gli input
        for (let i = 1; i <= numQuote; i++) {
            const percentualeLeft = ((i - 1) % 4) * 25; // Distribuisce le input box su 4 colonne
            const percentualeTop = Math.floor((i - 1) / 4) * 30 + 10; // Incrementa la riga ogni 4 input
    
    
            const inputBox = document.createElement('input');
            inputBox.type = 'number';
            inputBox.className = `input-lato lato-addProfile`; // Modifica 'lato-esempio' con l'ID del profilo appropriato
            inputBox.id = `lato${i}-addProfile`; // Modifica 'esempio' con l'ID del profilo appropriato
            inputBox.style.cssText = `top: ${percentualeTop}%; left: ${percentualeLeft}%;`;
            inputBox.placeholder = 'x';
            containerInputQuote.appendChild(inputBox);
            
    
            
        }
        document.getElementById('containerInputQuote').addEventListener('click', function(event) {
            // Verifica se l'elemento cliccato è un inputBox

            

            if (event.target && event.target.matches('.input-lato.lato-addProfile')) {

                const containerInputControllo = document.getElementById('containerInputControllo');
                containerInputControllo.style.display = 'block';
                const elementId = event.target.id;
        
                if (controlInputsById[elementId]) {

                    for (let id in controlInputsById) {
                        if (controlInputsById.hasOwnProperty(id) && id !== elementId) {
                            controlInputsById[id].forEach(container => {
                                container.style.display = 'none';
                            });
                        }
                    }
                    
                    console.log("if")
                    // Le input per questo ID sono già state create, quindi mostra quelle esistenti
                    controlInputsById[elementId].forEach(input => {
                        input.style.display = 'block';
                    });
                } else {
                    // Primo click su questo elemento, crea le input
                  //  removeControlInputs();
                    console.log("else")
                  
                    const inputTop = createControlInput(event.target, 'top');
                    const inputLeft = createControlInput(event.target, 'left');
        
                    // Salva le input nel nostro oggetto
                    controlInputsById[elementId] = [inputTop, inputLeft];
                    
                    for (let id in controlInputsById) {
                        if (controlInputsById.hasOwnProperty(id) && id !== elementId) {
                            controlInputsById[id].forEach(container => {
                                container.style.display = 'none';
                            });
                        }
                    }
                    
                }
            }
        });

    });


   
    function createControlInput(inputBox, type) {
        const containerInputControllo = document.getElementById('containerInputControllo');
        
        // Crea un contenitore div per la label e l'input
        const inputContainer = document.createElement('div');
        inputContainer.className = 'input-container';
    
        const label = document.createElement('label');
        label.textContent = type === 'top' ? "Coordinata Y quota:" : "Coordinata X quota:";
        inputContainer.appendChild(label);
    
        const controlInput = document.createElement('input');
        controlInput.type = 'number';
        controlInput.className = `input-controllo-${type}`;
        controlInput.value = type === 'top' ? extractPercentage(inputBox.style.top) : extractPercentage(inputBox.style.left);
    
        controlInput.addEventListener('input', function() {
            inputBox.style[type] = `${this.value}%`;
        });
    
        inputContainer.appendChild(controlInput);
    
        // Aggiungi il contenitore div al container principale
        containerInputControllo.appendChild(inputContainer);
    
        // Restituisce il contenitore div che contiene sia la label che l'input
        return inputContainer;
    }

    
    function removeControlInputs() {
        const containerInputControllo = document.getElementById('containerInputControllo');
        containerInputControllo.style.display = 'none';
    }
    
    function extractPercentage(value) {
        const match = value.match(/(\d+)%/);
        return match ? match[1] : "0"; // Restituisce "0" se non c'è corrispondenza
    }
    

    document.getElementById('datiSviluppoButton').addEventListener('click', function() {
        // Nascondi le input di controllo
        const containerInputControllo = document.getElementById('containerInputControllo');
        containerInputControllo.style.display = 'none';
        const listaSviluppo = document.getElementById('listaSviluppo');
      
        listaSviluppo.style.display = 'block'; // Rendi visibile il contenitore
        const versoVerniciatura = document.getElementById('containerInputImmagini');
        versoVerniciatura.style.display = 'none';
    
        // Se le input sono già state create, mostrale soltanto
            if (isDatiSviluppoCreated) {
                console.log(isDatiSviluppoCreated)
                listaSviluppo.style.display = 'block';
                return;
            }
        // Aggiungi una intestazione
        const heading = document.createElement('h3');
        heading.textContent = 'Configura scalatura in base allo spessore';
        listaSviluppo.appendChild(heading);
    
        const date = ['8/10', '10/10', '12/10', '15/10', '20/10', '30/10'];
        
        date.forEach(function(data) {
            const div = document.createElement('div');
    
            // Aggiungi uno spazio vuoto prima di "8/10" se è presente
            if (data === '8/10') {
                div.textContent = '\u2000' + data + ': '; // Aggiungi un carattere di spazio largo prima di "8/10"
            } else {
                div.textContent = data + ': ';
            }
            
            
    
            const input = document.createElement('input');
            input.type = 'text'; // O 'number', a seconda delle tue esigenze
            input.placeholder = 'Inserisci valore';
    
            div.appendChild(input);
            listaSviluppo.appendChild(div);
        });

        isDatiSviluppoCreated = true;
    });
    
    document.getElementById('versoVerniciatura').addEventListener('click', function() {
        const containerInputControllo = document.getElementById('containerInputControllo');
        containerInputControllo.style.display = 'none';
        const listaSviluppo = document.getElementById('listaSviluppo');
        listaSviluppo.style.display = 'none';


        // Verifica se le input box sono state create in precedenza
    if (imageControlInputs.length === 0) {
            // Creazione delle due immagini
            const image1 = document.createElement('img');
            image1.src = 'static/img/freccia_interna.png';
            image1.className = 'spostabile';
            
            image1.style.position = 'absolute';
            image1.style.margin = '0';
            image1.style.width = 'auto';
            image1.style.cursor = 'pointer';
            image1.style.border = '3px solid transparent';
            image1.style.top = '30%';
            image1.style.left = '30%';
            const image2 = document.createElement('img');
            image2.src = 'static/img/freccia_esterna.png';
            image2.className = 'spostabile';
            image2.style.position = 'absolute';
            image2.style.margin = '0';
            image2.style.width = 'auto';
            image2.style.cursor = 'pointer';
            image2.style.border = '3px solid transparent';
            image2.style.top = '35%';
            image2.style.left = '35%';
            image1.style.width = "20px";
            image1.style.height = "20px";


            image2.style.width = "20px";
            image2.style.height = "20px";
            // Aggiungi le immagini al contenitore
            const imageContainer = document.querySelector('.image-container');
            imageContainer.appendChild(image1);
            imageContainer.appendChild(image2);

            // Crea gli input di controllo per le immagini
            const inputsForImage1 = createImageControlInputs(image1);
            const inputsForImage2 = createImageControlInputs(image2);
            imageControlInputs.push(image1,image2,inputsForImage1,inputsForImage2);
     
            console.log(imageControlInputs);
        } else {
            // Le input box sono già state create, quindi mostra quelle esistenti
            console.log('imageControlInputs prima del forEach:', imageControlInputs);

            imageControlInputs.forEach(item => {
                const containerInputImmagini = document.getElementById('containerInputImmagini');
                containerInputImmagini.style.display = 'block'; // Assicurati che sia visibil
                if (Array.isArray(item)) {
                    // Se l'elemento è un array, scorri ogni elemento input nell'array
                    item.forEach(input => {
                        input.style.display = 'block';
                    });
                } else {
                    // Se l'elemento non è un array, gestiscilo direttamente
                    item.style.display = 'block';
                }
            });
            
        }
    });

    function createImageControlInputs(image) {
        const containerInputImmagini = document.getElementById('containerInputImmagini');
        
        const labelVern1 = document.createElement('label');
        const labelVern2 = document.createElement('label');
        labelVern1.textContent = "Coordinata Y Verso Interno:";
        labelVern2.textContent = "Coordinata X Verso Esterno:";
    
        containerInputImmagini.appendChild(labelVern1);
        
        // Crea gli input di controllo per 'top' e 'left'
        const inputControlloTop = document.createElement('input');
        inputControlloTop.type = 'number';
        inputControlloTop.className = 'input-controllo-top';
        inputControlloTop.value = 0; // Valore iniziale per 'top'
        inputControlloTop.min = 0;
        inputControlloTop.max = 100;
        inputControlloTop.step = "1";
      
    
        inputControlloTop.addEventListener('input', function() {
            image.style.top = `${this.value}%`;
        });
    
        const inputControlloLeft = document.createElement('input');
        inputControlloLeft.type = 'number';
        inputControlloLeft.className = 'input-controllo-left';
        inputControlloLeft.value = 0; // Valore iniziale per 'left'
        inputControlloLeft.min = 0;
        inputControlloLeft.max = 100;
        inputControlloLeft.step = "1";
    
        inputControlloLeft.addEventListener('input', function() {
            image.style.left = `${this.value}%`;
        });
    
        // Aggiungi gli input di controllo al contenitore
        containerInputImmagini.appendChild(inputControlloTop);
        containerInputImmagini.appendChild(labelVern2);
        containerInputImmagini.appendChild(inputControlloLeft);
        return [inputControlloTop, inputControlloLeft];
    }
    
    document.getElementById('saveProfileButton').addEventListener('click', function() {
        let profileName = prompt("Per favore, inserisci un nome per il profilo:");
    
        // Verifica se l'utente ha effettivamente inserito un nome
        if (profileName === null || profileName.trim() === "") {
            alert("Devi inserire un nome per il profilo per continuare.");
            return; // Interrompi la funzione se non viene fornito un nome
        }
        

        let spessori = ['8/10', '10/10', '12/10', '15/10', '20/10', '30/10'];
        let listaSviluppoValues = Array.from(document.getElementById('listaSviluppo').querySelectorAll('input')).map(input => input.value);

        let scala_values = {};
        listaSviluppoValues.forEach((valore, indice) => {
            let spessore = spessori[indice];
            scala_values[spessore] = valore;
        });
        let profileData = {
            profileName: profileName,
            imageSrc: document.getElementById('imagePreview').src,
            containerInputQuoteValues: Array.from(document.getElementById('containerInputControllo').querySelectorAll('input')).map(input => input.value),
            listaSviluppoValues: scala_values,
            containerInputImmaginiValues: Array.from(document.getElementById('containerInputImmagini').querySelectorAll('input')).map(input => input.value)
        };
        console.log(profileData);
        // Invia i dati al server
        fetch('/save_profile', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(profileData)
        })
        .then(response => response.json())
        .then(data => console.log('Success:', data))
        .catch((error) => console.error('Error:', error));
    });

    var materialeDropdown = document.getElementById('materiale');
    var tipologiaDropdown = document.getElementById('tipologia');
    var spessoreDropdown = document.getElementById('spessore');
    var coloreDropdown = document.getElementById('colore');
    

    function triggerChangeEvent(element) {
        var event = new Event('change');
        element.dispatchEvent(event);
    }

  
    materialeDropdown.addEventListener('change', function() {
        var materialeSelezionato = this.value;
        aggiornaTipologia(materialeSelezionato);

    });
    
    tipologiaDropdown.addEventListener('change', function() {
        var tipologiaSelezionata = this.value;
        aggiornaSpessoreColore(materialeDropdown.value, tipologiaSelezionata);

    });
    

    function isMobileDevice() {
        var userAgent = navigator.userAgent || navigator.vendor || window.opera;
    
        // Controlli per sistemi operativi mobili comuni
        if (/windows phone/i.test(userAgent)) {
            return true;
        }
    
        if (/android/i.test(userAgent)) {
            return true;
        }
    
        if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
            return true;
        }
    
        // Se nessuno dei controlli precedenti è vero, si presume che sia un desktop
        return false;
    }
    

    function aggiornaBadgeCarrello() {
        var conteggio = carrello.length;
        document.getElementById('conteggioCarrello').textContent = conteggio;
    }

    function resetColoreDropdown() {
        // Resetta la dropdown del colore al suo stato iniziale
        coloreDropdown.innerHTML = '';
        var opzioneVuota = document.createElement('option');
        opzioneVuota.textContent = "Colore";
        opzioneVuota.value = "";
        opzioneVuota.disabled = true;
        opzioneVuota.selected = true;
        opzioneVuota.hidden = true;
        coloreDropdown.appendChild(opzioneVuota);
        coloreDropdown.disabled = true;
    }

    function aggiornaTipologia(materiale) {
        var opzioniTipologia;
        if (materiale === 'Alluminio') {
            opzioniTipologia = ['Grezzo', 'Verniciato','Mandorlato'];
        } else if (materiale === 'Ferro') {
            opzioniTipologia = ['Zincata','Zincata Bugnata','Zincata Striata', 'SPO', 'Nera','Nera Bugnata','Nera Striata'];
        } else if (materiale === 'Acciaio') {
            opzioniTipologia = ['Satinato', 'Lucido', 'S.B', 'Grezzo'];
        } else if (materiale === 'PVC') {
            opzioniTipologia = ['Verniciato'];
        }
        aggiornaDropdown(tipologiaDropdown, opzioniTipologia);
    }
    
    function aggiornaSpessoreColore(materiale, tipologia) {
        var opzioniSpessore, opzioniColore;
        
        if (materiale === 'Alluminio' ) {
            if (tipologia === 'Verniciato') {
                  // Resetta il colore dopo il cambio di materiale
                  opzioniSpessore = ['12/10'];
                  opzioniColore = ['Bianco', 'Nero', 'Avorio', 'Bianco Opaco', 'Grigio Scuro', 'Grigio Chiaro', 'Grigio Raf.', 'Verde Raf.', 'Verde', 'Bronzo', 'Argento ox', 'Argento Verniciato','Marrone','Marrone Raf.'];
                  aggiornaDropdown(coloreDropdown, opzioniColore);
                  coloreDropdown.disabled = false;
                
            } 
            
            else if (tipologia === 'Mandorlato') {
                resetColoreDropdown();  // Resetta il colore dopo il cambio di materiale
                opzioniSpessore = ['15/10', '20/10', '30/10'];
                coloreDropdown.disabled = true;
            
            } 
            else  {
                resetColoreDropdown();
                opzioniSpessore = ['10/10', '12/10', '15/10', '20/10', '30/10'];
                coloreDropdown.disabled = true;
            }

            
            
        } else if (materiale === 'Acciaio') {
            resetColoreDropdown();  // Resetta il colore dopo il cambio di materiale
            opzioniSpessore = ['10/10', '12/10', '15/10', '20/10', '30/10'];
            coloreDropdown.disabled = true;
        
        } 
        
        else if (materiale === 'Ferro') {
            if (tipologia === 'Zincata Bugnata' || tipologia === 'Zincata Striata'|| tipologia === 'Nera Bugnata' || tipologia === 'Nera Striata') {
                resetColoreDropdown();  // Resetta il colore dopo il cambio di materiale
                opzioniSpessore = ['20/10', '30/10','50/10'];
                coloreDropdown.disabled = true;
            } else {
                resetColoreDropdown();  // Resetta il colore dopo il cambio di materiale
                opzioniSpessore = ['8/10', '10/10', '12/10', '15/10', '20/10', '25/10', '30/10', '40/10', '50/10', '60/10', '80/10', '100/10'];
                coloreDropdown.disabled = true;
            }
   
        
        
        } else if (materiale === 'PVC') {
            resetColoreDropdown();  // Resetta il colore dopo il cambio di materiale
            opzioniSpessore = ['12/10'];
            opzioniColore = ['Golden OAK', 'Noce', 'Bianco Venato', 'Rovere Sbiancato'];
            aggiornaDropdown(coloreDropdown, opzioniColore);
            coloreDropdown.disabled = false;
        }
    
        aggiornaDropdown(spessoreDropdown, opzioniSpessore);
    }
    
    function aggiornaDropdown(dropdown, opzioni) {
        dropdown.innerHTML = '';
        var opzioneVuota = document.createElement('option');
        opzioneVuota.value = "";
        opzioneVuota.disabled = true;
        opzioneVuota.selected = true;
        opzioneVuota.hidden = true;
    
        // Imposta il testo del placeholder in base all'ID del dropdown
        if (dropdown.id === 'tipologia') {
            opzioneVuota.textContent = "Tipologia";
        } else if (dropdown.id === 'spessore') {
            opzioneVuota.textContent = "Spessore";
        } else if (dropdown.id === 'colore') {
            opzioneVuota.textContent = "Colore";
        }
    
        dropdown.appendChild(opzioneVuota);
    
        opzioni.forEach(function(opzione) {
            var elemento = document.createElement('option');
            elemento.textContent = opzione;
            elemento.value = opzione;
            dropdown.appendChild(elemento);
        });
    
        dropdown.disabled = false;
    }
    

    

    var profiloSelezionato = null;
    document.addEventListener('DOMContentLoaded', function() {
       
        fetch('/data/profili')
        .then(response => response.json())
        .then(data => {
            data.profili.forEach(profilo => {
            addProfileToGrid(profilo);
            addProfileToMeasureSection(profilo);
            caricaScalature(profilo);
            });
        })
        .catch(error => {
            console.error('Error fetching the JSON:', error);
        });


        function caricaScalature(jsonData) {
             // Estrai i dati di scalatura e popola l'oggetto scalatureData
            
             jsonData.Scalature.forEach(scalatura => {
                    scalatureData[scalatura.id] = scalatura;
                });
                console.log(scalatureData)
           
        }

            function addProfileToMeasureSection(profilo) {
                console.log("Aggiunta sezione di misura per:", profilo.id);
                let measureSection = document.createElement('div');
                measureSection.className = `measure-section ${profilo.id}`;
                measureSection.id = 'drawSection';
            
                let imageContainer = document.createElement('div');
                imageContainer.className = `image-container ${profilo.id}`;
            
                let img = document.createElement('img');
                img.src = profilo.imageUrl;
                img.alt = profilo.id;
            
                imageContainer.appendChild(img);
            
                profilo.inputBoxes.forEach(box => {
                let input = document.createElement('input');
                input.type = 'number';
                input.className = `input-lato lato-${profilo.id}`;
                input.id = box.id;
                input.style.top = box.top;
                input.style.left = box.left;
                input.placeholder = box.placeholder;
                imageContainer.appendChild(input);

                addVerniciaturaSection(profilo,imageContainer);

                });
            
                measureSection.appendChild(imageContainer);
                let container = document.querySelector('#measureSection .flex-container');
                    let dropdownContainer = container.querySelector('.dropdown-container');
                
                    if (dropdownContainer) {
                        container.insertBefore(measureSection, dropdownContainer);
                    } else {
                        container.appendChild(measureSection);
             }

        }


        function addVerniciaturaSection(profilo, imageContainer) {
            console.log("Aggiunta sezione di verniciatura per:", profilo.id);
            
            let scelteVerniciato = document.createElement('div');
            scelteVerniciato.className = 'scelteVerniciato';
            scelteVerniciato.style.display = 'none';
        
            profilo.vernBoxes.forEach(box => {
                let imgVern = document.createElement('img');
                imgVern.src = box.url;
                imgVern.className = 'opzioneVerniciato';
                imgVern.id = box.id;
                imgVern.style.position = 'absolute';
                imgVern.style.margin = '0';
                imgVern.style.width = '20px';
                imgVern.style.height = '20px';
                imgVern.style.top = box.top;
                imgVern.style.left = box.left;
        
                scelteVerniciato.appendChild(imgVern);
            });
        
            imageContainer.appendChild(scelteVerniciato);
        }
        

          function addProfileToGrid(profilo) {
                let profileDiv = document.createElement('div');
                profileDiv.className = 'profile';
                profileDiv.style.backgroundImage = `url('${profilo.imageUrl}')`;
                profileDiv.setAttribute('data-target', profilo.id);
                
                // Aggiungi altre proprietà necessarie al profileDiv
                
                document.querySelector('.profile-grid').appendChild(profileDiv);
          }
          


          document.querySelector('.profile-grid').addEventListener('click', function(event) {
            // Controlla se l'elemento cliccato (o un suo genitore) ha la classe 'profile'
            let profile = event.target.closest('.profile');
            if (!profile) return; // ignora i click che non sono sui profili
            var targetClass = profile.getAttribute('data-target');
            profiloSelezionato = targetClass;
            var riferimentoOrdine = document.getElementById('riferimento_ordine');
            var riferimento = document.getElementById('riferimento');

            riferimento.value = riferimentoOrdine.value;

            if (profiloSelezionato === 'libero') {
                
                initializeCanvas();
            }

            if (profiloSelezionato === 'Scatola') {
                var elemento = document.getElementById('altezza');
                elemento.value = '1';        // Imposta il valore a 1
    
                elemento.disabled = true;  
            }
            // Nascondi tutte le sezioni
            document.querySelectorAll('.measure-section').forEach(function(section) {
                section.style.display = 'none';
            });

            // Mostra la sezione corrispondente
            var targetSection = document.querySelector('.' + targetClass);
            
            if (targetSection) {
                targetSection.style.display = 'flex';
                document.querySelectorAll('.dropdown-container').forEach(function(element) {
                    element.style.display = 'flex';
                });

                resetScelteVerniciato();
                targetSection.scrollIntoView();
        }

            
            

               
        });
    
        // Gestione click su pulsante Torna Indietro
        document.getElementById('btnTornaIndietro').addEventListener('click', function() {
            // Nasconde la sezione dei risultati
            document.getElementById('risultatiSviluppo').style.display = 'none';

            // Mostra la sezione dei profili e la sezione di misura
            document.getElementById('profile-section').style.display = 'block';
            document.getElementById('measureSection').style.display = 'block';

            // Opzionale: rimuovere la classe active-section
            var activeSections = document.querySelectorAll('.measure-section.active-section');
            activeSections.forEach(function(section) {
                section.classList.remove('active-section');
            });
        });

        document.getElementById('btnProsegui').addEventListener('click', function() {
            // Azioni da eseguire quando si clicca su Prosegui
           
            // Qui puoi inserire il codice per navigare a una nuova pagina o altro
        });
      
        const canvas = document.getElementById('drawingCanvas');
     

    });
    
    window.addEventListener('resize', (e) => {
        if (document.activeElement.tagName === "INPUT") {
            e.preventDefault();
          
            // Puoi anche inserire qui la logica per mantenere il canvas come desiderato
        }
    });

    let ctx;
    let StartX;
    let StartY;
 
    const canvas = document.getElementById('drawingCanvas');
    const drawSection = document.getElementById('drawSection');
    const gridSize = 40;
    let isDrawing = false, isDimensioning = false, lastX = 0, lastY = 0, isErasing = false;
    




    document.getElementById('pencil').addEventListener('click', () => {
        isDrawing = true;
        isErasing = false;
        isDimensioning = false;
        ctx.strokeStyle = '#000000'; // Colore delle linee del disegno
        ctx.lineWidth = 4; // Spessore delle linee
        ctx.globalCompositeOperation = 'source-over'; // Imposta la modalità di disegno normale
        updateButtonStyles();
    });

    document.getElementById('eraserTool').addEventListener('click', () => {
        isErasing = true;
        isDrawing = false;
        isDimensioning = false;
        
        undo();
    });

    document.getElementById('refresh').addEventListener('click', () => {
        
        SaveInput();
        drawGrid();
        if (undoStack.length > 0) {
            const lastState = undoStack[undoStack.length - 1];
           
            
            restoreCanvas(lastState.canvasState);
            restoreInputs(lastState.inputsState);
        } else {
           
        }
    });

    document.getElementById('dimension').addEventListener('click', () => {
        isDimensioning = !isDimensioning;
        isDrawing = false; // Disabilita il disegno quando si passa alla quotatura
        isErasing = false; // Disabilita la gomma
        updateButtonStyles();
    });

    document.getElementById('eraser').addEventListener('click', () => {
        clearCanvas(); // Questa funzione pulisce il canvas
        removeDimensions(); // Questa funzione rimuove tutte le quote
        document.getElementById('pencil').click(); // Simula il clic sul pulsante "Matita"
    });

    //document.getElementById('deleteDimensions').addEventListener('click', removeDimensions);

    // Event listeners per il canvas
    canvas.addEventListener('mousedown', handleTouchStart);

    canvas.addEventListener('mousemove', (e) => {
        if (!isDrawing) return;
        [lastX, lastY] = getPosition(e); // Traccia solo le coordinate
       
    });

    canvas.addEventListener('mouseup', () => {
        if (isErasing) {
            drawGrid(); // Ridisegna la griglia
        }
        if (isDrawing) {
          
            
            drawLineFromStartToEnd();
            StartX = lastX;
            StartY = lastY;
        }
        isDrawing = false;
        ctx.lineWidth = 4; // Ripristina la larghezza della linea per il disegno
        
    });

    canvas.addEventListener('mouseout', stopDrawing);
    canvas.addEventListener('touchstart', handleTouchStart);
    canvas.addEventListener('touchmove', (e) => {
        if (!isDrawing) return;
        [lastX, lastY] = getPosition(e); // Traccia solo le coordinate
    });
    canvas.addEventListener('touchend', () => {
        if (isErasing) {
            drawGrid(); // Ridisegna la griglia
        }
        if (isDrawing) {
            drawLineFromStartToEnd();
            StartX = lastX;
            StartY = lastY;
        }
        isDrawing = false;
        ctx.lineWidth = 4; // Ripristina la larghezza della linea per il disegno
        
    });

  

    function initializeCanvas() {
        drawSection.style.display = 'flex';
        if (!canvas.getAttribute('data-initialized')) {
            canvas.width = drawSection.offsetWidth;
            canvas.height = drawSection.offsetHeight;
            ctx = canvas.getContext('2d');
            canvas.setAttribute('data-initialized', 'true');
            
            drawGrid();
            //setupEventListeners();
        }
       
    }

    function updateButtonStyles() {
        const pencilButton = document.getElementById('pencil');
        const dimensionButton = document.getElementById('dimension');
        const eraserToolButton = document.getElementById('eraserTool');

        if (isDrawing) {
            pencilButton.classList.add('button-selected');
            dimensionButton.classList.remove('button-selected');
            eraserToolButton.classList.remove('button-selected');
        } else if (isDimensioning) {
            dimensionButton.classList.add('button-selected');
            pencilButton.classList.remove('button-selected');
            eraserToolButton.classList.remove('button-selected');
        } else if (isErasing) {
            eraserToolButton.classList.add('button-selected');
            pencilButton.classList.remove('button-selected');
            dimensionButton.classList.remove('button-selected');
        } else {
            pencilButton.classList.remove('button-selected');
            dimensionButton.classList.remove('button-selected');
            eraserToolButton.classList.remove('button-selected');
        }
    }

    function clearCanvas() {
        if (!ctx) return; // Verifica che ctx sia definito
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawGrid();
        undoStack.length = 0;

    }

    function setDrawing() {
        isDrawing = true;
        isErasing = false;
        isDimensioning = false;
        ctx.globalCompositeOperation = 'source-over'; // Modalità di disegno normale
        ctx.strokeStyle = '#000000'; // Colore delle linee del disegno
        ctx.lineWidth = 4; // Spessore delle linee
    }

    function drawGrid() {
        if (!ctx) return;
        
        ctx.strokeStyle = '#eaeaea';
        ctx.lineWidth = 1;
        for (let x = 0; x <= canvas.width; x += gridSize) {
            ctx.beginPath();
            ctx.moveTo(x, 0);
            ctx.lineTo(x, canvas.height);
            ctx.stroke();
        }
        for (let y = 0; y <= canvas.height; y += gridSize) {
            ctx.beginPath();
            ctx.moveTo(0, y);
            ctx.lineTo(canvas.width, y);
            ctx.stroke();
        }
    }

    //commentare
    function draw(e) {
        if (!isDrawing) return;
        e.preventDefault();
    
        let [x, y] = getPosition(e);
        let angle = calculateAngle(StartX, StartY, x, y);
    
        // Aggiornamento del range per la linea obliqua
        if (angle < 20 || angle > 160) {
            drawHorizontalLine(StartY, x);
        } else if (angle >= 20 && angle <= 70 || angle >= 110 && angle <= 160) {
            drawObliqueLineFrom(StartX, StartY, angle);
        } else {
            drawVerticalLine(StartX, y);
        }
    
        // Aggiornamento delle coordinate di partenza per il prossimo segmento
        StartX = x;
        StartY = y;
    }

    function drawLineFromStartToEnd() {
        let angle = calculateAngle(StartX, StartY, lastX, lastY);
       
        let deltaX = Math.abs(lastX - StartX); // Differenza assoluta in X
      
        let threshold = 10; // Un valore soglia per decidere tra verticale e obliqua
    
        if (angle < 20 || angle > 160 && angle < 200 || angle > 340) {
            drawHorizontalLine(StartY, lastX);
        } else if (deltaX < threshold) {
            // Considera la linea verticale se la differenza in X è minore della soglia
            drawVerticalLine(StartX, lastY);
        } else {
            // Altrimenti, considerala obliqua
            drawObliqueLineFrom(StartX, StartY, lastX, lastY);
        }
        lineeDisegnate.push({ StartX, StartY, lastX, lastY, angle });
        saveState();
    }
    

    


    let undoStack = [];
    let isCanvasModified = false;
    let lineeDisegnate = [];

    function saveState() {
        const currentCanvasState = canvas.toDataURL();
        const currentInputsState = Array.from(document.querySelectorAll('input[type="text"]:not(.nome_cliente):not(.riferimento_ordine)')).map(input => ({
            id: input.id,
            value: input.value,
            position: { left: input.style.left, top: input.style.top }
        }));
    
        const lastState = undoStack.length > 0 ? undoStack[undoStack.length - 1] : null;

        if (!lastState || lastState.canvasState !== currentCanvasState || JSON.stringify(lastState.inputsState) !== JSON.stringify(currentInputsState)) {
            undoStack.push({ canvasState: currentCanvasState, inputsState: currentInputsState });
            console.log('Stato salvato. Contenuto attuale di undoStack:', undoStack);
        }

    }

    function SaveInput() {
        
        const currentInputsState = Array.from(document.querySelectorAll('input[type="text"]:not(.nome_cliente):not(.riferimento_ordine)')).map(input => ({
            id: input.id,
            value: input.value,
            position: { left: input.style.left, top: input.style.top }
        }));
    
        const lastState = undoStack[undoStack.length - 1];
      
         // Controlla se il canvas è stato modificato o se le input-box sono cambiate
        if (isCanvasModified || !lastState || JSON.stringify(lastState.inputsState) !== JSON.stringify(currentInputsState)) {
            undoStack.push({ canvasState: lastState.canvasState, inputsState: currentInputsState });
            isCanvasModified = false; // Resetta il flag dopo aver salvato lo stato
        }
    }
    
    
    function undo() {
        if (undoStack.length > 0) {
            const lastState = undoStack.pop();
            restoreCanvas(lastState.canvasState);
            restoreInputs(lastState.inputsState);
        }
    }
    
    function restoreCanvas(dataUrl) {
        let img = new Image();
        img.onload = function() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(img, 0, 0);
        };
        img.src = dataUrl;
        
    }

    
    
    
    function restoreInputs(inputsState) {
        // Rimuovi tutte le input-box esistenti
      
        const inputs = document.querySelectorAll('input[type="text"]:not(.nome_cliente):not(.riferimento_ordine)');
        inputs.forEach(input => input.remove());
     
        // Ricrea le input-box salvate
        inputsState.forEach(inputState => {
            const container = document.getElementById('drawingCanvasParent'); // Usa il contenitore esterno
        
            const input = document.createElement('input');
            input.type = 'text';
            input.style.position = 'absolute';
            input.style.left = inputState.position.left;
            input.style.top = inputState.position.top;
            input.style.width = '50px';
            input.style.height = '20px';
            input.style.border = '1px solid #ccc';
            input.style.zIndex = '100';
            input.value = inputState.value; // Assicurati di ripristinare il valore
            container.appendChild(input); // Aggiungi al contenitore esterno
        });
    }

  
    function drawLine(ctx, x1, y1, x2, y2) {
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.stroke();
    }

    function getPosition(e) {
        let x, y;
        const rect = canvas.getBoundingClientRect();
     
        if (e.touches && e.touches.length > 0) {
            const touch = e.touches[0];
            x = (touch.clientX - rect.left) * (canvas.width / rect.width);
            y = (touch.clientY - rect.top) * (canvas.height / rect.height);
         
        } else {
            // Usa direttamente e.offsetX e e.offsetY per gli eventi desktop
            x = (e.clientX - rect.left) * (canvas.width / rect.width);
            y = (e.clientY - rect.top) * (canvas.height / rect.height);
          
        }
    
        return [x, y];
    }
    
    
    
    
    

    function calculateAngle(startX, startY, endX, endY) {
        let dy = endY - startY;
        let dx = endX - startX;
        let theta = Math.atan2(dy, dx); // Restituisce un angolo in radianti
        let angle = theta * 180 / Math.PI; // Converti in gradi
        if (angle < 0) {
            angle += 360; // Normalizza l'angolo tra 0 e 360
        }
        return angle;
    }
    


    function drawHorizontalLine(y, xTo) {
        let startX = Math.min(StartX, xTo);
        let endX = Math.max(StartX, xTo);
        
        ctx.beginPath();
        ctx.moveTo(startX, y);
        ctx.lineTo(endX, y);
        ctx.stroke();
    }
    
    function drawVerticalLine(x, yTo) {
      
    
        let startY = Math.min(StartY, yTo);
        let endY = Math.max(StartY, yTo);
    
        ctx.beginPath();
        ctx.moveTo(x, startY);
        ctx.lineTo(x, endY);
        ctx.stroke();
    }
    
    
    
    function drawObliqueLineFrom(x1, y1, x2, y2) {
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.stroke();
    }


    function startDrawing(x, y) {
        // Reimposta le proprietà di stile per il disegno
        ctx.strokeStyle = '#000000'; // Colore nero per il disegno
        ctx.lineWidth = 4;           // Spessore della linea per il disegno
    
        ctx.beginPath();
        ctx.moveTo(x, y);
    }

    function stopDrawing() {
        // Non reimpostare isDrawing su false qui
        // Così l'utente rimane in modalità disegno dopo aver rilasciato il mouse
        // isDrawing = false; // Commenta o rimuovi questa linea
    }

    function handleTouchStart(e) {
        e.preventDefault();
        [StartX, StartY] = getPosition(e); // Imposta StartX e StartY per il tocco
        
    
        if (isDimensioning) {
            const [x, y] = getPosition(e);
            addInputBox(x, y);
        } else {
            isDrawing = true; // Inizia il disegno
        }
    
        lastX = StartX; // Imposta anche lastX e lastY
        lastY = StartY;
        
        saveState();
    }

    function addInputBox(x, y) {
        const canvasRect = canvas.getBoundingClientRect();
        const parentRect = document.getElementById('drawingCanvasParent').getBoundingClientRect();
        const container = document.getElementById('drawingCanvasParent');
        const inputWidth = 50;
        const inputHeight = 20;
    
        // Calcola il centro della input-box rispetto al punto di click
        x = x + canvasRect.left - parentRect.left - inputWidth / 2;
        y = y + canvasRect.top - parentRect.top - inputHeight / 2;
    
        const input = document.createElement('input');
        input.type = 'text';
        input.className = 'input-lato libero';
        input.style.position = 'absolute';
        input.style.left = `${x}px`;
        input.style.top = `${y}px`;
        input.style.width = `${inputWidth}px`;
        input.style.height = `${inputHeight}px`;
        input.style.border = '1px solid #ccc';
        input.style.zIndex = '100';
    
        container.appendChild(input);
        saveState();
    }
    

    function removeDimensions() {
        const inputs = document.querySelectorAll('input[type="text"]:not(.nome_cliente):not(.riferimento_ordine)');
        inputs.forEach(input => input.remove());
    }



        // Gestione navigazione con tasto Enter
        var inputBoxes = document.querySelectorAll('.input-lato');
        inputBoxes.forEach(function(input, index) {
            input.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault(); // Previene il comportamento di default del tasto Invio
                    // Passa al prossimo input box, se esiste
                    if (index < inputBoxes.length - 1) {
                        inputBoxes[index + 1].focus();
                    }
                }
            });
        });

        //gestion pulsante "carrello"
        var carrello = [];
        document.getElementById('btnAggiungiCarrello').addEventListener('click', function() {
            // Resetta gli stili dei campi in caso siano stati precedentemente marcato come mancanti
            document.querySelectorAll('.campoMancante').forEach(function(campo) {
                campo.classList.remove('campoMancante');
            });
          
        
            var errori = [];
        
            var dropdown1 = document.getElementById('spessore');
            var dropdown2 = document.getElementById('materiale');
            var dropdown3 = document.getElementById('tipologia');
            var dropdown4 = document.getElementById('colore');
            var numPezzi = document.getElementById('numPezzi');
            var altezza = document.getElementById('altezza');
            var tipologiaSelezionata = document.getElementById('tipologia').value;
            var riferimento = document.getElementById('riferimento');

            // Controlla se la tipologia è "Verniciato" e se almeno una delle opzioni è stata selezionata
            if (tipologiaSelezionata === 'Verniciato' || tipologiaSelezionata === 'Satinato'  || tipologiaSelezionata === 'Mandorlato'  || tipologiaSelezionata === 'Lucido'  || tipologiaSelezionata === 'S.B' ) {
                var opzioneSelezionata = document.querySelector('.opzioneVerniciato.selezionata');
                console.log(opzioneSelezionata)
                if (opzioneSelezionata === null && profiloSelezionato !== "Linea" && profiloSelezionato !== "libero") {
                    alert("Seleziona verso verniciatura.");
                    return; // Interrompe ulteriori azioni di questo evento
                }
            }
        
            [dropdown1, dropdown2, dropdown3, dropdown4, numPezzi, altezza].forEach(function(campo) {
                // Controlla se la dropdown è abilitata e se il valore è vuoto
                if (!campo.disabled && !campo.value) {
                  
                    campo.classList.add('campoMancante');
                    errori.push(campo.getAttribute('id'));
                }
            });
        
            // Aggiungi la logica per applicare lo stile al genitore della casella di selezione
            [dropdown1, dropdown2, dropdown3, dropdown4].forEach(function(dropdown) {
                if (!dropdown.disabled && !dropdown.value) {
                    dropdown.parentNode.classList.add('campoMancante');
                }
            });
        
        
            // Controlla e marca le input delle misurazioni se sono vuote
            document.querySelector('.measure-section.' + profiloSelezionato).querySelectorAll('.input-lato').forEach(function(input) {
                if (input.value === '') {
                    input.classList.add('campoMancante');
                    errori.push("misurazione");
                }
            });
        
            if (errori.length > 0) {
                var messaggioErrore = "Per favore, completa i seguenti campi: " + errori.join(", ");
                alert(messaggioErrore);
                return;
            }
            
            //screenshot del profilo quotato
           
            const canvasElement = document.getElementById('drawingCanvasParent');
            
          

            if (profiloSelezionato == 'libero') {
                var elemento = document.getElementById('drawingCanvasParent');
                
            } else {
                var elemento = document.querySelector('.image-container.' + profiloSelezionato);
            }
            
            domtoimage.toPng(elemento)
                .then(function (dataUrl) {
                    var immagineDataUrl = dataUrl;
                    canvasElement.style.transform = '';
                    var datiMisurazioni = {};
                    document.querySelector('.measure-section.' + profiloSelezionato).querySelectorAll('.input-lato').forEach(function(input, index) {
                        if (input.value !== '') {
                            datiMisurazioni["Lato" + (index + 1)] = input.value;
                        }
                    });
            
                    var datiCarrello = {
                        profilo: profiloSelezionato,
                        immagineDataUrl: immagineDataUrl,
                        pezzi: numPezzi.value,
                        altezza: altezza.value,
                        spessore: dropdown1.value,
                        materiale: dropdown2.value,
                        tipologia: dropdown3.value,
                        colore: dropdown4.value,
                        datiMisurazioni: datiMisurazioni,
                        riferimento: riferimento.value
                    };
            
                    carrello.push(datiCarrello);
                 
            
                    // Aggiorna il conteggio del carrello e resetta il pulsante e le input box
                    document.getElementById('conteggioCarrello').textContent = carrello.length;
                    var btn = document.getElementById('btnAggiungiCarrello');
                    btn.textContent = 'Aggiunto!';
                    document.getElementById('btnMostraCarrello').style.display = 'block';
                    setTimeout(function() {
                        btn.textContent = 'Aggiungi al Carrello';
                    }, 2000);
            
                    // Reset delle input box dopo aver salvato i dati
                    document.querySelectorAll('#numPezzi, #altezza').forEach(function(input) {
                        input.value = '';
                    });
                })
                .catch(function (error) {
                    console.error('Si è verificato un errore durante la conversione dell\'immagine:', error);
                    
                });
                
           
        });
        
        
        //mostra carrello
        document.getElementById('btnMostraCarrello').addEventListener('click', function() {
            // Nascondi le altre sezioni
            document.getElementById('profile-section').style.display = 'none';
            document.getElementById('input-section').style.display = 'none';
            document.getElementById('measureSection').style.display = 'none';
        
            // Funzione per aggiornare la visualizzazione del carrello
            function aggiornaVisualizzazioneCarrello() {
                var containerElementi = document.getElementById('elementiCarrello');
                containerElementi.innerHTML = ''; // Pulisce vecchi contenuti
        
                carrello.forEach(function(elemento, indice) {
                img = 'static/img/' + elemento.immagineDataUrl
                
                var htmlProfilo = '<div class="elementoCarrello">' +
                    '<img src="'+ elemento.immagineDataUrl + '" alt="Profilo Quotato" class="imgCarrello">';  
            
        
                var dettagliHtml = '<div class="dettagliProfilo">';
        
                // Aggiungi le misure
                for (var misura in elemento.misurazioni) {
                    dettagliHtml += '<p>' + misura + ': ' + elemento.misurazioni[misura] + '</p>';
                }
        
                 // Aggiungi N. Pezzi e Altezza e altri dettagli
                dettagliHtml += '<p>N. Pezzi: ' + elemento.pezzi + '</p>';
                dettagliHtml += '<p>Altezza: ' + elemento.altezza + '</p>';
                dettagliHtml += '<p>Materiale: ' + elemento.materiale + '</p>';
                dettagliHtml += '<p>Spessore: ' + elemento.spessore + '</p>';
                dettagliHtml += '<p>Tipologia: ' + elemento.tipologia + '</p>';
                dettagliHtml += '<p>Colore: ' + elemento.colore + '</p>';
                dettagliHtml += '</div>'; // Chiusura del contenitore dettagliProfilo

                // Aggiungi un'icona di rimozione
                var iconaRimozioneHtml = '<span class="rimuovi-icona" data-indice="' + indice + '">&#10005;</span>';
                // Aggiungi un'icona di modifica
                var iconaModificaHtml = '<span class="modifica-icona" data-indice="' + indice + '">&#9998;</span>'; // Usa un simbolo appropriato per la modifica

                // Modifica il profilo HTML per includere l'icona di modifica
                var htmlProfilo = '<div class="elementoCarrello">' + iconaRimozioneHtml + iconaModificaHtml +
                    '<img src="' + elemento.immagineDataUrl + '" alt="Profilo Quotato" class="imgCarrello">' +
                    dettagliHtml + '</div>';

                containerElementi.innerHTML += htmlProfilo;
            });
        
            // Mostra la sezione del carrello
            document.getElementById('dettagliCarrello').style.display = 'block';

                // Aggiungi event listener per le icone di rimozione
            document.querySelectorAll('.rimuovi-icona').forEach(function(icona) {
                icona.addEventListener('click', function() {
                    var indice = this.getAttribute('data-indice');
                    if (confirm('Confermi la rimozione dell\'elemento dal carrello?')) {
                        carrello.splice(indice, 1);
                        aggiornaVisualizzazioneCarrello(); // Aggiorna nuovamente la visualizzazione del carrello
                        aggiornaBadgeCarrello(); // Aggiorna il badge del carrello
                    }
                });
            });

            // Aggiungi event listener per le icone di modifica
            document.querySelectorAll('.modifica-icona').forEach(function(icona) {
                icona.addEventListener('click', function() {
                    var indice = this.getAttribute('data-indice');
                    var elementoDaModificare = carrello[indice]; // Raccogli i dati dell'elemento

                    if (confirm('Vuoi modificare questo elemento?')) {

                        carrello.splice(indice, 1);
                        aggiornaVisualizzazioneCarrello(); 
                        aggiornaBadgeCarrello();
                        // Nascondi la sezione del carrello e mostra le sezioni per aggiungere nuovi elementi
                        document.getElementById('dettagliCarrello').style.display = 'none';
                        document.getElementById('profile-section').style.display = 'block';
                        document.getElementById('input-section').style.display = 'block';
                        document.getElementById('measureSection').style.display = 'block';
                        console.log('Contenuto del carrello:', carrello);
                        // Imposta i valori nei campi di input e dropdown

                          // Resettare tutti gli input a null quando si entra nella modalità di modifica
                        document.querySelectorAll('.input-lato').forEach(function(input) {
                            input.value = '';
                        });


                        document.getElementById('colore').value = '';
                        document.getElementById('spessore').value = '';
                        // Resettare e innescare l'evento change per le dropdown
                        document.getElementById('materiale').value = '';
                        
                        document.getElementById('tipologia').value = '';
            
                        document.getElementById('materiale').value = elementoDaModificare.materiale;
                        triggerChangeEvent(document.getElementById('materiale'));
                        document.getElementById('tipologia').value = elementoDaModificare.tipologia;
                        triggerChangeEvent(document.getElementById('tipologia'));
                        document.getElementById('spessore').value = elementoDaModificare.spessore;
                        document.getElementById('colore').value = elementoDaModificare.colore;
                        document.getElementById('numPezzi').value = elementoDaModificare.pezzi;
                        document.getElementById('altezza').value = elementoDaModificare.altezza;
            
                        // Gestione della visualizzazione del profilo selezionato
                        var targetClass = elementoDaModificare.profilo; // Assumendo che 'profilo' sia una proprietà di elementoDaModificare
                        profiloSelezionato = targetClass;
                        if (profiloSelezionato === 'libero') {
                            initializeCanvas();
                        }
                        // Nascondi tutte le sezioni
                        document.querySelectorAll('.measure-section').forEach(function(section) {
                            section.style.display = 'none';
                        });
                        // Mostra la sezione corrispondente
                        var targetSection = document.querySelector('.' + targetClass);
                        if (targetSection) {
                            targetSection.style.display = 'flex';
                            document.querySelectorAll('.dropdown-container').forEach(function(element) {
                                element.style.display = 'flex';
                            });
                            resetScelteVerniciato();
                        }
                        targetSection.scrollIntoView();
                    }
                });
            });


        }

        // Inizialmente popola la visualizzazione del carrello
        aggiornaVisualizzazioneCarrello();
        aggiornaBadgeCarrello(); // Aggiorna il badge del carrello
    });
        
         
       

        function getUrlImmagine(profilo) {
            // Restituisci l'URL dell'immagine in base al nome del profilo
            // Ad esempio:
            return  profilo + '.png'; // Modifica in base alla tua struttura di file
        }
        
        document.getElementById('btnAggiungiElementi').addEventListener('click', function() {
            // Nascondi la sezione del carrello
            document.getElementById('dettagliCarrello').style.display = 'none';
        
            // Mostra le sezioni per aggiungere nuovi elementi
            document.getElementById('profile-section').style.display = 'block';
            document.getElementById('input-section').style.display = 'block';
            document.getElementById('measureSection').style.display = 'block';
            // ... altre sezioni da mostrare se necessario ...10
        });
        


    function calcolaVarScalatura(profilo, spessore) {

        if (scalatureData[profilo]) {
            return parseInt(scalatureData[profilo][spessore]) || 0;
        }

        switch(profilo) {
            case "omega":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10": return 6;
                    case "15/10": return 7;
                    case "20/10": return 10;
                    case "30/10": return 16;
                    // Aggiungi altri casi per "zeta" qui
                }
                break;
            // Aggiungi altri casi per diversi profili qui
            case "zeta":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10":
                    case "15/10": return 3;
                    case "20/10": return 4;
                    case "30/10": return 6;
                    // Aggiungi altri casi per "zeta" qui
                }
                break;
            case "Ami":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10": return 3;
                    case "15/10": return 6;
                    case "20/10": return 5;
                    case "30/10": return 8;
                    // Aggiungi altri casi per "zeta" qui
                }
            break;   
            case "OmegaInt":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10": return 8;
                    case "15/10": return 10;
                    case "20/10": return 14;
                    case "30/10": return 21;
                    // Aggiungi altri casi per "zeta" qui
                }
            break; 
            case "OmegaIntAsi":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10": return 8;
                    case "15/10": return 10;
                    case "20/10": return 14;
                    case "30/10": return 21;
                    // Aggiungi altri casi per "zeta" qui
                }
            break; 
            case "L":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10": 
                    case "15/10": return 2;
                    case "20/10": return 3;
                    case "30/10": return 5;
                    // Aggiungi altri casi per "zeta" qui
                }
            break;
            case "omega5":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10": return 12;
                    case "15/10": return 14;
                    case "20/10": return 20;
                    case "30/10": return 31;
                    // Aggiungi altri casi per "zeta" qui
                }
            break;
            case "OmegaAsi":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10": return 8;
                    case "15/10": return 12;
                    case "20/10": return 16;
                    case "30/10": return 20;
                    // Aggiungi altri casi per "zeta" qui
                }
            break;
            case "OmegaAsi2":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10":
                    case "15/10": return 8;
                    case "20/10": return 11;
                    case "30/10": return 19;
                    // Aggiungi altri casi per "zeta" qui
                }
            break;
            case "Amo":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10":
                    case "15/10": return 1;
                    case "20/10": return 0;
                    case "30/10": return 3;
                    // Aggiungi altri casi per "zeta" qui
                }
            break;
            case "gancio":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10": return 4;
                    case "15/10": return 5;
                    case "20/10": return 7;
                    case "30/10": return 11;
                    // Aggiungi altri casi per "zeta" qui
                }
            break;
            case "u":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10": return 4;
                    case "15/10": return 5;
                    case "20/10": return 7;
                    case "30/10": return 11;
                    // Aggiungi altri casi per "zeta" qui
                }
            break;
                case "Scatola":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10": return 4;
                    case "15/10": return 5;
                    case "20/10": return 7;
                    case "30/10": return 11;
                    // Aggiungi altri casi per "zeta" qui
                }
            break;
                case "Freccia":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10": 
                    case "15/10": return 2;
                    case "20/10": return 3;
                    case "30/10": return 5;
                    // Aggiungi altri casi per "zeta" qui
                }
            break;
                case "L45":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10": 
                    case "15/10": return 2;
                    case "20/10": return 3;
                    case "30/10": return 5;
                    // Aggiungi altri casi per "zeta" qui
                }
            break;
                case "P":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10": return 6;
                    case "15/10": return 7;
                    case "20/10": return 10;
                    case "30/10": return 16;
                    // Aggiungi altri casi per "zeta" qui
                }
            break;
                case "P_rovescia":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10": return 6;
                    case "15/10": return 7;
                    case "20/10": return 10;
                    case "30/10": return 16;
                    // Aggiungi altri casi per "zeta" qui
                }
            break;
        }
        return 0; // Restituisci 0 se non viene trovata alcuna corrispondenza
    }
    
    document.getElementById('btnSviluppo').addEventListener('click', function() {
        var nomeCliente = document.getElementById('nome_cliente').value;
        var riferimentoOrdine = document.getElementById('riferimento_ordine').value;
        var dataOdierna = new Date().toLocaleDateString();
        var elementoContatorePerPagina = 0;
        
            // Ordina il carrello prima di raggrupparlo
        carrello.sort(function(a, b) {

            // Dai la priorità ai profili di tipo "libero"
            if (a.profilo === "libero" && b.profilo !== "libero") {
                return -1;
            }
            if (a.profilo !== "libero" && b.profilo === "libero") {
                return 1;
            }
            // Confronta per Materiale
            if (a.materiale < b.materiale) return -1;
            if (a.materiale > b.materiale) return 1;

            // Confronta per Tipologia
            if (a.tipologia < b.tipologia) return -1;
            if (a.tipologia > b.tipologia) return 1;

            // Confronta per Colore
            if (a.colore < b.colore) return -1;
            if (a.colore > b.colore) return 1;

            // Confronta per Spessore
            if (a.spessore < b.spessore) return -1;
            if (a.spessore > b.spessore) return 1;

            return 0; // Se tutti i criteri sono uguali
        });
        // Raggruppa gli elementi per materiale e poi per profilo e misurazioni
        var materialeGruppi = {};

            // Estrai combinazioni uniche
            var combinazioniUniche = {};
            carrello.forEach(function(elemento) {
                var chiaveCombinazione = getElementoChiaveCombinazione(elemento); // Funzione per determinare la chiave
                if (!combinazioniUniche[chiaveCombinazione]) {
                    combinazioniUniche[chiaveCombinazione] = { somma: 0, descrizione: chiaveCombinazione };
                }

                var varScalatura = calcolaVarScalatura(elemento.profilo, elemento.spessore);
                console.log(elemento)

                if (elemento.profilo === "Scatola") {

                    var sommaPrimiTreLati = parseFloat(elemento.datiMisurazioni.Lato1) 
                        + parseFloat(elemento.datiMisurazioni.Lato2) 
                        + parseFloat(elemento.datiMisurazioni.Lato3);

                    var sommaPrimiSecondiLati = parseFloat(elemento.datiMisurazioni.Lato4) 
                        + parseFloat(elemento.datiMisurazioni.Lato5) 
                        + parseFloat(elemento.datiMisurazioni.Lato6);


                        sommaPrimiTreLati = sommaPrimiTreLati - varScalatura
                        sommaPrimiSecondiLati = sommaPrimiSecondiLati - varScalatura


                    var sommaMisurazioni = sommaPrimiTreLati * sommaPrimiSecondiLati
                   
                    combinazioniUniche[chiaveCombinazione].somma += elemento.pezzi * sommaPrimiSecondiLati * sommaPrimiTreLati;
                    console.log("elemento.pezzi:" +elemento.pezzi)
                    console.log("sommaPrimiSecondiLati" +sommaPrimiSecondiLati)
                    console.log("sommaPrimiTreLati:" +sommaPrimiTreLati)
                    console.log(combinazioniUniche[chiaveCombinazione].somma)
                }
            
                else {

                    var sommaMisurazioni = Object.values(elemento.datiMisurazioni).reduce((acc, val) => acc + parseFloat(val), 0);
                    sommaMisurazioni = sommaMisurazioni - varScalatura;
                    combinazioniUniche[chiaveCombinazione].somma += elemento.pezzi * elemento.altezza * sommaMisurazioni;
                }
                
            });

        // Calcola il numero di colonne e righe per la griglia
        var numeroCombinazioni = Object.keys(combinazioniUniche).length;
        var colonne = Math.ceil(Math.sqrt(numeroCombinazioni));
        var righe = Math.ceil(numeroCombinazioni / colonne);
        var pesoTotale = 0;
        var pesiTotaliPerCombinazione = {}; // Nuovo oggetto per tenere traccia del peso totale per ogni combinazione
        // Calcolo del numero di profili "Libero" e Standard
        var numeroProfiliLibero = 0;
        var numeroProfiliStandard = 0;

        carrello.forEach(function(elemento) {
            var materialeFittizio = "MaterialeUnico";
            var chiaveCombinazione = `${elemento.materiale}-${elemento.spessore}`; // Chiave basata su materiale e spessore
            var chiaveProfiloMisurazione = `${materialeFittizio}-${elemento.profilo}-${JSON.stringify(elemento.datiMisurazioni)}-${elemento.materiale}-${elemento.tipologia}-${elemento.spessore}-${elemento.colore || ''}`;

            if (elemento.profilo === "libero") {
                numeroProfiliLibero++;
            } else {
                numeroProfiliStandard++;
            }
        


            if (!pesiTotaliPerCombinazione[chiaveCombinazione]) {
                pesiTotaliPerCombinazione[chiaveCombinazione] = 0;
            }
            
            pesiTotaliPerCombinazione[chiaveCombinazione] += calcolaPesoTeorico(elemento.materiale, elemento.spessore);
            console.log("peso: "+pesiTotaliPerCombinazione[chiaveCombinazione])

            if (!materialeGruppi[materialeFittizio]) {
                materialeGruppi[materialeFittizio] = {};
            }

            if (!materialeGruppi[materialeFittizio][chiaveProfiloMisurazione]) {
                materialeGruppi[materialeFittizio][chiaveProfiloMisurazione] = {
                    elementi: [],
                    datiMisurazioni: elemento.datiMisurazioni,
                    profilo: elemento.profilo,
                    materiale: elemento.materiale,
                    tipologia: elemento.tipologia,
                    spessore: elemento.spessore,
                    colore: elemento.colore || ''
                };
            }

            materialeGruppi[materialeFittizio][chiaveProfiloMisurazione].elementi.push(elemento);
        });

        // Ora pesiTotaliPerCombinazione conterrà il peso totale per ogni combinazione unica di materiale e spessore
  
    
        var finestraStampa = window.open('', '_blank');
        if (finestraStampa) {
            finestraStampa.document.write('<html><head><title>Dettagli Ordine</title><style>');
      

            finestraStampa.document.write('.container { border: 0px solid black; width: 210mm; height: 294mm; display: flex; flex-direction: column; align-items: flex-start; justify-content: flex-start; }');
            finestraStampa.document.write('.elemento { display: flex; flex-direction: column; align-items: center; width: 49%; margin: 1px; border: 1px solid black; }'); // Layout in colonna per .elemento
            finestraStampa.document.write('.content { display: flex; flex-direction: row; width: 100%; }'); // Stile per .content
            finestraStampa.document.write('.dettagli-container { display: flex; flex-direction: column; width: 50%;color: red;  font-weight: bold; text-align: end; margin: 12px;}'); // Stile per .dettagli-container
            finestraStampa.document.write('.info-section { width: 100%; text-align: center; border-top: 1px solid gray; color: red;  font-weight: bold;}'); // Stile per .info-section
      
            finestraStampa.document.write('.dettagli { margin: 1px; }'); // Stile per .dettagli
            finestraStampa.document.write('.elemento img { width: 100%; height: auto; max-height: 100%; }'); // Imposta max-height in percentuale
       
          
            
            finestraStampa.document.write('.header-info { display: flex; justify-content: space-between; width: 100%; margin-bottom: 1px; }');
            finestraStampa.document.write('.row { display: flex; width: 100%; justify-content: space-around; flex-wrap: wrap; }');
          
    
            finestraStampa.document.write('</style></head><body>');

            
           // Calcola il numero totale di elementi
           var numeroTotaleElementi = 0;
           for (var materiale in materialeGruppi) {
               for (var chiaveProfiloMisurazione in materialeGruppi[materiale]) {
                   numeroTotaleElementi += materialeGruppi[materiale][chiaveProfiloMisurazione].elementi.length;
               }
           }
           
            var numeroTotaleSlot = numeroProfiliLibero * 2 + numeroProfiliStandard;
            var numeroPagine = Math.ceil(numeroTotaleSlot / 8); 
            var slotPerPagina = 8;
            
            var elementiStampati = 0; // Variabile per tenere traccia degli elementi stampati
            var indiceCorrente = 0; 
           
           for (var pagina = 0; pagina < numeroPagine; pagina++) {    
            
                    finestraStampa.document.write('<div class="container" style="margin-bottom: 2px;">');

                    finestraStampa.document.write('<div class="header-info" style="font-weight: bold;"><span>Data: ' + dataOdierna + '</span><span style="color:red;">Cliente: ' + nomeCliente + '</span><span style="color:blue;">Riferimento Ordine: ' + riferimentoOrdine + '</span></div>');
                

                    var riferimentoFatto = true;
                    var slotOccupati = 0;        
                    var contatore = 1;
                    var profiliMisurazioniGruppi = materialeGruppi[materiale];
                    var chiaviProfiloMisurazione = Object.keys(profiliMisurazioniGruppi);
                
                    var elementoContatore = 0;
           
        
                    while (indiceCorrente < chiaviProfiloMisurazione.length && slotOccupati < slotPerPagina) {
                        var chiaveProfiloMisurazione = chiaviProfiloMisurazione[indiceCorrente];
                      
                        
                        indiceCorrente++;
                        var gruppo = profiliMisurazioniGruppi[chiaveProfiloMisurazione];
                        var percentualeAltezza = 100 / gruppo.elementi.length;

                      
                        // Ordina gli elementi del gruppo per altezza, dal maggiore al minore
                        gruppo.elementi.sort((a, b) => b.altezza - a.altezza);

                        

                        if (slotOccupati % 2 === 0 || slotOccupati === slotPerPagina) {
                
                            if (slotOccupati < slotPerPagina) {
                        
                                finestraStampa.document.write('<div class="row">');
                            }
                        }
                        
                        if (gruppo.profilo === "libero" && (slotPerPagina - slotOccupati) >= 2) {  

                           
                            slotOccupati += 2;
                         
                            if (isMobileDevice()) {

                                finestraStampa.document.write('<div class="elemento" style="width: 100%;">');
                                finestraStampa.document.write('<div class="content">'); // Nuovo div .content
                                finestraStampa.document.write('<img src="' + gruppo.elementi[0].immagineDataUrl + '" style="width: 30%;">'); // Immagine
                                finestraStampa.document.write('<div class="dettagli-container">'); // Container per i dettagli
    
                            } else {
                                finestraStampa.document.write('<div class="elemento" style="width: 100%;">');
                                finestraStampa.document.write('<div class="content">'); // Nuovo div .content
                                finestraStampa.document.write('<img src="' + gruppo.elementi[0].immagineDataUrl + '" style="width: 65%;">'); // Immagine
                                finestraStampa.document.write('<div class="dettagli-container">'); // Container per i dettagli
            
                            }

                           
                        } else {
                            // Altrimenti, aggiungi un profilo standard che occupa 1 slot
                       
                            slotOccupati += 1;
                       
    

                            finestraStampa.document.write('<div class="elemento">');
                            finestraStampa.document.write('<div class="content">'); // Nuovo div .content
                            finestraStampa.document.write('<img src="' + gruppo.elementi[0].immagineDataUrl + '" style="width: 50%;">'); // Immagine
                            finestraStampa.document.write('<div class="dettagli-container">'); // Container per i dettagli

                        } 

                          
                            if (gruppo.materiale === "Alluminio" && gruppo.tipologia === "Verniciato") {
                                var infoSectionContent = `${gruppo.materiale} ${gruppo.colore}`;    
                            } else {
                                var infoSectionContent = `${gruppo.materiale} ${gruppo.spessore} ${gruppo.tipologia} ${gruppo.colore}`;    
                            }
                        
                            
                            
                            riferimentoFatto = true;
                            let ultimoRiferimento = null; 
                            gruppo.elementi.forEach(function(elemento,indice) {
                                var varScalatura = calcolaVarScalatura(elemento.profilo, elemento.spessore);
                               
                                if (elemento.profilo === "Scatola") {
                                    console.log("entro scatola")
                                    var sommaPrimiTreLati = parseFloat(elemento.datiMisurazioni.Lato1) 
                                        + parseFloat(elemento.datiMisurazioni.Lato2) 
                                        + parseFloat(elemento.datiMisurazioni.Lato3);
                    
                                    var sommaPrimiSecondiLati = parseFloat(elemento.datiMisurazioni.Lato4) 
                                        + parseFloat(elemento.datiMisurazioni.Lato5) 
                                        + parseFloat(elemento.datiMisurazioni.Lato6);
                    
                    
                                        sommaPrimiTreLati = sommaPrimiTreLati - varScalatura
                                        sommaPrimiSecondiLati = sommaPrimiSecondiLati - varScalatura
                    
                    
                                    var sommaMisurazioni = sommaPrimiTreLati;
                                    
                                    elemento.altezza = sommaPrimiSecondiLati;
                    
                                    console.log("elemento.altezza. "+elemento.altezza)
                                    console.log("sommaPrimiTreLati "+sommaPrimiTreLati)
                                    console.log("sommaPrimiSecondiLati "+sommaPrimiSecondiLati)
                                    console.log("varScalatura "+varScalatura)
                                    }

                                else {

                                var sommaMisurazioni = Object.values(elemento.datiMisurazioni).reduce((acc, val) => acc + parseFloat(val), 0);
                                sommaMisurazioni = sommaMisurazioni - varScalatura;
                                }
            
                                finestraStampa.document.write('<div class="dettagli">');
                                    console.log ("indice: "+indice)
                                    console.log ("elemento.riferimento: "+elemento.riferimento)
                                    console.log ("ultimoRiferimento: "+ultimoRiferimento)
                                    if (indice === 0 || elemento.riferimento !== ultimoRiferimento) {
                                       
                                            console.log("riferimento profilo presente: " + elemento.riferimento);
                                            finestraStampa.document.write('<p style="margin: 1%; color:blue;">' + elemento.riferimento + '</p>');
                                            riferimentoFatto = false;
                                       
                                    }
                                
                                    ultimoRiferimento = elemento.riferimento;

                                if (elemento.profilo === "libero" ) {
                                    finestraStampa.document.write('<p style="margin: 0%;">N.'+elemento.pezzi+' ' + elemento.altezza + '</p>');
                            
                                }

                                finestraStampa.document.write('<p style="margin: 0%;">N.'+elemento.pezzi+' ' + elemento.altezza + ' x ' + sommaMisurazioni + '</p>');
                            
                                finestraStampa.document.write('</div>'); // Chiusura dei div 'dettagli'
                            });
            

                            
                            finestraStampa.document.write('</div>'); // Chiusura di .dettagli-container
                            finestraStampa.document.write('</div>'); // Chiusura di .content
                            finestraStampa.document.write('<div class="info-section">' + infoSectionContent + '</div>');
                            
                            finestraStampa.document.write('</div>'); // Chiusura di .elemento
                
        
                        elementoContatore++;
        
                        if (slotOccupati % 2 === 0 || slotOccupati === slotPerPagina) {
                            // Chiusura della riga corrente
                            finestraStampa.document.write('</div>');
                        }
                          // Condizione per limitare a 8 elementi per pagina
                        if (contatore >= 8) {
                            break; // Interrompe il ciclo interno, passando alla pagina successiva
                        }
                        contatore++;



                    }
                        
                    // Aggiungi stile CSS per il footer
                    // All'interno della funzione che genera il footer
                    finestraStampa.document.write('<div class="footer">');
                        Object.keys(combinazioniUniche).forEach(function(chiaveCombinazione) {
                     
                            var parti = chiaveCombinazione.split(' ');
                        
                            var spessore, materiale, tipologia, colore;
                            if (parti.length === 4) {
                                // Ferro o Acciaio
                                [spessore, materiale, tipologia, colore] = parti;
                            } else if (parti.length === 2 ||parti.length ===3 ) {
                                // Alluminio
                          
                                [materiale, colore] = parti;
                                spessore = "12/10"; // Se vuoi usare un valore predefinito
                            }
                        
          
                            // Resto del codice...
                            var pesoPerMetroQuadro = calcolaPesoTeorico(materiale, spessore);
               
                            var sommaMisurazioni = combinazioniUniche[chiaveCombinazione].somma; // Somma delle misurazioni in cm²
             
                            var pesoFinale = (pesoPerMetroQuadro * sommaMisurazioni)/ 1000000; // Calcola il peso finale
                            pesoFinale = pesoFinale.toFixed(2);
                        
                            finestraStampa.document.write('<div class="footer-cell">' + chiaveCombinazione + ' - Peso teorico: ' + pesoFinale + ' kg</div>');
                        });
                        
                        
                        
                        if (elementoContatore % 2 === 0 || elementoContatore === Object.keys(profiliMisurazioniGruppi).length) {
                            finestraStampa.document.write('</div>'); // Chiudi la riga
                        }
                        finestraStampa.document.write('</div>'); // Chiudi il footer
                        finestraStampa.document.write('<style>');
                        finestraStampa.document.write('.footer { display: grid; grid-template-columns: 1fr 1fr; width: 100%; }');
                        finestraStampa.document.write('.footer-cell { border: 1px solid black; padding: 1px; }');
                        finestraStampa.document.write('</style>');
                        
                        finestraStampa.document.write('</div>'); // Chiudi il contenitore
                        
                        
                       
                        finestraStampa.document.write('</div>'); // Close the container
                   
                        if (indiceCorrente >= chiaviProfiloMisurazione.length) {
                            // Fine dell'oggetto, esci dal ciclo esterno
                            break;
                        }   
                
            }
               
            finestraStampa.document.write('</body></html>');
            finestraStampa.document.close();
            finestraStampa.focus();
 

      
            } else {
                console.error('Impossibile aprire la finestra di stampa.');
        }

       // Raccogli l'HTML generato
               
       var htmlContent = finestraStampa.document.documentElement.outerHTML;
       generaEInviaPDF(htmlContent);        
        
    });

    document.querySelectorAll('.input-lato').forEach(function(input) {
        input.addEventListener('focus', function() {
            // Resetta il valore dell'input quando riceve il focus
            this.value = '';
        });
    });

    function getElementoChiaveCombinazione(elemento) {
        if ((elemento.materiale === "Alluminio" ||elemento.materiale === "PVC" ) && elemento.tipologia === "Verniciato") {
            return `${elemento.materiale} ${elemento.colore}`;
        } else {
            return `${elemento.spessore} ${elemento.materiale} ${elemento.tipologia} ${elemento.colore}`;
        }
    }

    function calcolaPesoTeorico(materiale, spessore) {
        let pesoPerMetroQuadro;
    
        if (materiale === "Ferro" || materiale === "Acciaio") {
            pesoPerMetroQuadro = 8; // peso in kg per metro quadro
        } else if (materiale === "Alluminio") {
            pesoPerMetroQuadro = 2.834; // peso in kg per metro quadro
        } 
        else if (materiale === "PVC") {
            pesoPerMetroQuadro = 2.97; // peso in kg per metro quadro
        }else {
            return 0; // Valore predefinito per altri materiali
        }
    
        let spessoreInMillimetri = parseInt(spessore.split("/")[0]) / 10;
        return pesoPerMetroQuadro * spessoreInMillimetri; // peso in kg per cm²
    }
    
    
    
    function resetScelteVerniciato() {
        document.querySelectorAll('.scelteVerniciato .opzioneVerniciato').forEach(function(img) {
            img.style.display = 'block'; // Mostra l'immagine
            img.classList.remove('selezionata'); // Rimuovi la selezione
        });
    }

    document.getElementById('tipologia').addEventListener('change', function() {
        var tipologiaSelezionata = this.value;
        var contenitoriScelte = document.querySelectorAll('.scelteVerniciato');
    
        contenitoriScelte.forEach(function(contenitore) {
            if (tipologiaSelezionata === 'Verniciato' || tipologiaSelezionata === 'Mandorlato'  || tipologiaSelezionata === 'Satinato'  || tipologiaSelezionata === 'Lucido'  || tipologiaSelezionata === 'S.B') {
                contenitore.style.display = 'block'; // Mostra le opzioni per Verniciato
            } else {
                contenitore.style.display = 'none'; // Nascondi le opzioni
            }
        });
    });
    
    document.querySelectorAll('.scelteVerniciato').forEach(function(contenitoreScelte) {
        contenitoreScelte.querySelectorAll('.opzioneVerniciato').forEach(function(img) {
            img.addEventListener('click', function() {
                // Controlla se l'immagine corrente è già selezionata
                var giaSelezionata = this.classList.contains('selezionata');
    
                // Deseleziona e nascondi tutte le immagini nello stesso contenitore
                contenitoreScelte.querySelectorAll('.opzioneVerniciato').forEach(function(i) {
                    i.style.display = 'none'; // Nascondi l'immagine
                    i.classList.remove('selezionata'); // Rimuovi la selezione
                });
    
                if (!giaSelezionata) {
                    // Se l'immagine corrente non era già selezionata, mostrala e selezionala
                    this.style.display = 'block';
                    this.classList.add('selezionata');
                } else {
                    // Se l'immagine corrente era già selezionata, mostra entrambe le opzioni
                    contenitoreScelte.querySelectorAll('.opzioneVerniciato').forEach(function(i) {
                        i.style.display = 'block'; // Mostra l'immagine
                    });
                }
            });
        });
    });
    
   
    function generaEInviaPDF(elementoDaConvertire) {
        // Ottieni i valori dai campi di input
        var nomeCliente = document.getElementById('nome_cliente').value;
        var riferimentoOrdine = document.getElementById('riferimento_ordine').value;
    
        // Ottieni l'elemento HTML che vuoi convertire in PDF
        
    
        // Opzioni per html2pdf
        var opzioni = {
            margin:       0,
            filename:     'ordine.pdf',
            image:        { type: 'jpeg', quality: 0.98 },
            html2canvas:  { scale: 0.9 },
            jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };
    
        // Utilizza html2pdf per convertire l'elemento
        html2pdf().from(elementoDaConvertire).set(opzioni).toPdf().get('pdf').then(function (pdfObj) {
            // Il PDF è stato creato, ora invialo al server insieme agli altri dati
            inviaDatiAlServer(pdfObj.output('blob'), nomeCliente, riferimentoOrdine);
        });
    }
    
    function inviaDatiAlServer(pdfBlob, nomeCliente, riferimentoOrdine) {
        var formData = new FormData();
        var nomePDF = nomeCliente+ '_'+riferimentoOrdine;
        formData.append('pdf', pdfBlob, nomePDF);
        formData.append('nome', nomeCliente);
        formData.append('riferimento_ordine', riferimentoOrdine);
    
        fetch('/send_email', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => console.log(data))
        .catch((error) => console.error('Error:', error));
    }
    
    
  
        
</script>

</body>

</html>
