<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="stile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>


<body>
<button id="btnMostraCarrello">
    <i class="fa fa-shopping-cart"></i>
    <span id="conteggioCarrello" class="badge">0</span>
</button>
<div class="header">
    <h1>Monaco's Inventory</h1>
</div>
<div class="input-container">
    <input type="text" class="input1" placeholder="Nome Cliente">
    <input type="text" class="input2" placeholder="Riferimento Ordine">
</div>

<div class="profile-section" id="profile-section">
    <h2>Scegli Profilo</h2>
    <div class="profile-grid">
        <!-- Ripeti questo blocco per 30 volte, cambia l'URL dell'immagine di sfondo per ciascun quadrato -->
        <div class="profile" style="background-image: url('img\\zeta2.png');" data-target="zeta"></div>
        <div class="profile" style="background-image: url('img\\omega.png');"data-target="omega"></div>
        <div class="profile" style="background-image: url('img\\Ami.png');"data-target="Ami"></div>
        <div class="profile" style="background-image: url('img\\Amo.png');"data-target="Amo"></div>
        <div class="profile" style="background-image: url('img\\gancio.png');"data-target="gancio"></div>
        <div class="profile" style="background-image: url('img\\L.png');"data-target="L"></div>
        <div class="profile" style="background-image: url('img\\OmegaAsi.png');" data-target="OmegaAsi"></div>
        <div class="profile" style="background-image: url('img\\OmegaInterno.png');"data-target="OmegaInterno"></div>
        <div class="profile" style="background-image: url('img\\u.png');"data-target="u"></div>
        <div class="profile" style="background-image: url('img\\Linea.png');"data-target="Linea"></div>
        <!-- <div class="profile" style="background-image: url('img\\u.png');"></div>
        <div class="profile" style="background-image: url('img\\u.png');"></div>
        <div class="profile" style="background-image: url('img\\omega.png');"></div>
        <div class="profile" style="background-image: url('img\\omega.png');"></div>
        <div class="profile" style="background-image: url('img\\omega.png');"></div>
        <div class="profile" style="background-image: url('img\\omega.png');"></div>
        <div class="profile" style="background-image: url('img\\omega.png');"></div>
        <div class="profile" style="background-image: url('img\\omega.png');"></div>
        <div class="profile" style="background-image: url('img\\boh.png');"></div>
        <div class="profile" style="background-image: url('img\\boh.png');"></div>
        <div class="profile" style="background-image: url('img\\boh.png');"></div>
        <div class="profile" style="background-image: url('img\\boh.png');"></div>
        <div class="profile" style="background-image: url('img\\boh.png');"></div>
        <div class="profile" style="background-image: url('img\\boh.png');"></div>
        <div class="profile" style="background-image: url('img\\angolare.png');"></div>
        <div class="profile" style="background-image: url('img\\angolare.png');"></div>
        <div class="profile" style="background-image: url('img\\angolare.png');"></div>
        <div class="profile" style="background-image: url('img\\angolare.png');"></div>
        <div class="profile" style="background-image: url('img\\angolare.png');"></div>
        <div class="profile" style="background-image: url('img\\angolare.png');"></div>
        <div class="profile" style="background-image: url('img\\angolare.png');"></div>
        ... altri 29 quadrati ... -->
    </div>
</div>


<div class="measure-section2" id="measureSection">

    <div class="flex-container">
        <div class="measure-section zeta" id="drawSection">
            <div class="image-container">
                <img src="img\zeta2.png" alt="zeta">
                <input type="number" class="input-lato lato-zeta" id="lato1-zeta" style="top: 2%; left: 10%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-zeta" id="lato2-zeta" style="top: 82%; left: 55%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-zeta" id="lato3-zeta" style="top: 47%; right: 60%; width: 20px;" placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section u" id="drawSection">
            <div class="image-container">
                <img src="img\u.png" alt="u">
                <input type="number" class="input-lato lato-u" id="lato1-u" style="top: 40%; left: 5%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-u" id="lato2-u" style="top: 65%; left: 47%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-u" id="lato3-u" style="top: 40%; right: 1%; width: 20px;" placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section L" id="drawSection">
            <div class="image-container">
                <img src="img\L.png" alt="L">

                <input type="number" class="input-lato lato-L" id="lato2-L" style="top: 31%; left: 1%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-L" id="lato3-L" style="top: 55%; right: 35%; width: 20px;" placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section Linea" id="drawSection">
            <div class="image-container">
                <img src="img\Linea.png" alt="Linea">

                <input type="number" class="input-lato lato-Linea" id="lato2-Linea" style="top: 31%; left: 45%; width: 20px;" placeholder="x">

                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section omega" id="drawSection">
            <div class="image-container">
                <img src="img\omega.png" alt="omega">
                <input type="number" class="input-lato lato-omega" id="lato1-omega" style="top: 15%; left: 10%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-omega" id="lato2-omega" style="top: 75%; left: 40%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-omega" id="lato3-omega" style="top: 15%; right: 5%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-omega" id="lato4-omega" style="top: 45%; right: 5%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-omega" id="lato5-omega" style="top: 45%; left: 10%; width: 20px;" placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section OmegaAsi" id="drawSection">
            <div class="image-container">
                <img src="img\OmegaAsi.png" alt="u">
                <input type="number" class="input-lato lato-OmegaAsi" id="lato1-OmegaAsi" style="top: 5%; left: 30%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi" id="lato2-OmegaAsi" style="top: 80%; left: 30%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi" id="lato3-OmegaAsi" style="top: 61%; right: 1%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi" id="lato4-OmegaAsi" style="top: 47%; left: 10%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi" id="lato5-OmegaAsi" style="top: 60%; left: 52%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi" id="lato6-OmegaAsi" style="top: 30%; right: 30%; width: 20px;" placeholder="x">
               
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section OmegaInterno" id="drawSection">
            <div class="image-container">
                <img src="img\OmegaInterno.png" alt="OmegaInterno">
                <input type="number" class="input-lato lato-OmegaInterno" id="lato1-u" style="top: 20%; left: 20%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaInterno" id="lato2-u" style="top: 70%; left: 35%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaInterno" id="lato3-u" style="top: 20%; right: 15%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaInterno" id="lato4-u" style="top: 47%; right: 2%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaInterno" id="lato5-u" style="top: 47%; left: 2%; width: 20px;" placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section Amo" id="drawSection">
            <div class="image-container">
                <img src="img\Amo.png" alt="Amo">
                <input type="number" class="input-lato lato-Amo" id="lato1-Amo" style="top: 30%; left: 20%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-Amo" id="lato2-Amo" style="top: 65%; left: 40%; width: 20px;" placeholder="x">
          
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section Ami" id="drawSection">
            <div class="image-container">
                <img src="img\Ami.png" alt="Ami">
                <input type="number" class="input-lato lato-Ami" id="lato1-Ami" style="top: 25%; left: 20%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-Ami" id="lato2-Ami" style="top: 60%; left: 35%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-Ami" id="lato3-Ami" style="top: 25%; right: 20%; width: 20px;" placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section gancio" id="drawSection">
            <div class="image-container">
                <img src="img\gancio.png" alt="gancio">
                <input type="number" class="input-lato lato-gancio" id="lato1-gancio" style="top: 20%; left: 30%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-gancio" id="lato2-gancio" style="top: 70%; left: 40%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-gancio" id="lato3-gancio" style="top: 50%; left: 1%; width: 20px;" placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="dropdown-container">
            <div class="dropdown-menus">
                <select id="materiale" class="dropdown">
                    <option value="" disabled selected hidden>Materiale</option>
                    <option value="Alluminio">Alluminio</option>
                    <option value="Ferro">Ferro</option>
                    <option value="Acciaio">Acciaio</option>
                </select>
            </div>
            <div class="dropdown-menus">
                <select id="tipologia" class="dropdown" disabled>
                    <option value="" disabled selected hidden>Tipologia</option>
                </select>
            </div>
            <div class="dropdown-menus">
                <select id="spessore" class="dropdown" disabled>
                    <option value="" disabled selected hidden>Spessore</option>
                </select>
            </div>
            <div class="dropdown-menus">
                <select id="colore" class="dropdown" disabled>
                    <option value="" disabled selected hidden>Colore</option>
                </select>
            </div>
        </div>
    </div>
    


    <div class="input-section" id="input-section">
        <div>
            <input type="number" id="numPezzi" style="width: 50px;" placeholder="N. Pezzi">
            <input type="number" id="altezza" style="width: 50px;" placeholder="Altezza">
            <button id="btnAggiungiCarrello">Aggiungi al Carrello</button>
           
        </div>
    </div>
</div>
<div class="risultatiSviluppo" id="risultatiSviluppo" style="display: none;">
  
    <button id="btnTornaIndietro">Torna Indietro</button>
    <button id="btnProsegui">Prosegui</button>
</div>

<div id="dettagliCarrello" style="display: none;">
    <h2>Contenuto del Carrello</h2>
    <div id="elementiCarrello">
        <!-- Dettagli degli elementi del carrello qui -->
    </div>
    <button id="btnAggiungiElementi">Aggiungi Altro</button>
    <button id="downloadButton">Scarica Ordine</button>
    <button id="btnInviaOrdine">Invia Ordine e Condividi</button>
    <button id="btnSviluppo">Sviluppo</button> 
</div>



<script>


    var materialeDropdown = document.getElementById('materiale');
    var tipologiaDropdown = document.getElementById('tipologia');
    var spessoreDropdown = document.getElementById('spessore');
    var coloreDropdown = document.getElementById('colore');
    
    materialeDropdown.addEventListener('change', function() {
        var materialeSelezionato = this.value;
        aggiornaTipologia(materialeSelezionato);

    });
    
    tipologiaDropdown.addEventListener('change', function() {
        var tipologiaSelezionata = this.value;
        aggiornaSpessoreColore(materialeDropdown.value, tipologiaSelezionata);

    });
    
    function aggiornaBadgeCarrello() {
        var conteggio = carrello.length;
        document.getElementById('conteggioCarrello').textContent = conteggio;
    }

    function resetColoreDropdown() {
        // Resetta la dropdown del colore al suo stato iniziale
        coloreDropdown.innerHTML = '';
        var opzioneVuota = document.createElement('option');
        opzioneVuota.textContent = "Colore";
        opzioneVuota.value = "";
        opzioneVuota.disabled = true;
        opzioneVuota.selected = true;
        opzioneVuota.hidden = true;
        coloreDropdown.appendChild(opzioneVuota);
        coloreDropdown.disabled = true;
    }

    function aggiornaTipologia(materiale) {
        var opzioniTipologia;
        if (materiale === 'Alluminio') {
            opzioniTipologia = ['Grezzo', 'Verniciato'];
        } else if (materiale === 'Ferro') {
            opzioniTipologia = ['Zincata', 'SPO', 'Nera'];
        } else if (materiale === 'Acciaio') {
            opzioniTipologia = ['Satinato', 'Lucido', 'S.B', 'Grezzo'];
        }
        aggiornaDropdown(tipologiaDropdown, opzioniTipologia);
    }
    
    function aggiornaSpessoreColore(materiale, tipologia) {
        var opzioniSpessore, opzioniColore;
        
        if (materiale === 'Alluminio') {
            if (tipologia === 'Grezzo') {
                resetColoreDropdown();  // Resetta il colore dopo il cambio di materiale
                opzioniSpessore = ['10/10', '15/10', '20/10', '30/10'];
                coloreDropdown.disabled = true;
            } else if (tipologia === 'Verniciato') {
                opzioniSpessore = ['12/10'];
                opzioniColore = ['Bianco', 'Nero', 'Avorio', 'Bianco Opaco', 'Grigio Scuro', 'Grigio Chiaro', 'Grigio Raf.', 'Verde Raf.', 'Verde', 'Bronzo', 'Argento ox', 'Argento Verniciato'];
                aggiornaDropdown(coloreDropdown, opzioniColore);
                coloreDropdown.disabled = false;
            }
        } else if (materiale === 'Ferro') {
            resetColoreDropdown();  // Resetta il colore dopo il cambio di materiale
            opzioniSpessore = ['8/10', '10/10', '12/10', '15/10', '20/10', '25/10', '30/10', '40/10', '50/10', '60/10', '80/10', '100/10'];
            coloreDropdown.disabled = true;
        } else if (materiale === 'Acciaio') {
            resetColoreDropdown();  // Resetta il colore dopo il cambio di materiale
            opzioniSpessore = ['8/10', '10/10', '15/10', '20/10', '30/10'];
            coloreDropdown.disabled = true;
        }
    
        aggiornaDropdown(spessoreDropdown, opzioniSpessore);
    }
    
    function aggiornaDropdown(dropdown, opzioni) {
        dropdown.innerHTML = '';
        var opzioneVuota = document.createElement('option');
        opzioneVuota.value = "";
        opzioneVuota.disabled = true;
        opzioneVuota.selected = true;
        opzioneVuota.hidden = true;
    
        // Imposta il testo del placeholder in base all'ID del dropdown
        if (dropdown.id === 'tipologia') {
            opzioneVuota.textContent = "Tipologia";
        } else if (dropdown.id === 'spessore') {
            opzioneVuota.textContent = "Spessore";
        } else if (dropdown.id === 'colore') {
            opzioneVuota.textContent = "Colore";
        }
    
        dropdown.appendChild(opzioneVuota);
    
        opzioni.forEach(function(opzione) {
            var elemento = document.createElement('option');
            elemento.textContent = opzione;
            elemento.value = opzione;
            dropdown.appendChild(elemento);
        });
    
        dropdown.disabled = false;
    }
    

    
    var profiloSelezionato = null;
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.profile').forEach(function(profile) {
            profile.addEventListener('click', function() {
                var targetClass = this.getAttribute('data-target');
                profiloSelezionato = targetClass;

                // Nascondi tutte le sezioni
                document.querySelectorAll('.measure-section').forEach(function(section) {
                    section.style.display = 'none';
                });

                // Mostra la sezione corrispondente
                var targetSection = document.querySelector('.' + targetClass);
                console.log("targetClass:", targetClass);
                console.log("targetSection:", targetSection);
                if (targetSection) {
                    targetSection.style.display = 'flex';
                    document.querySelectorAll('.dropdown-container').forEach(function(element) {
                        element.style.display = 'flex';
                    });
            }

            
            targetSection.scrollIntoView();

                });
        });
    
        // Gestione click su pulsante Torna Indietro
        document.getElementById('btnTornaIndietro').addEventListener('click', function() {
            // Nasconde la sezione dei risultati
            document.getElementById('risultatiSviluppo').style.display = 'none';

            // Mostra la sezione dei profili e la sezione di misura
            document.getElementById('profile-section').style.display = 'block';
            document.getElementById('measureSection').style.display = 'block';

            // Opzionale: rimuovere la classe active-section
            var activeSections = document.querySelectorAll('.measure-section.active-section');
            activeSections.forEach(function(section) {
                section.classList.remove('active-section');
            });
        });
        document.getElementById('btnProsegui').addEventListener('click', function() {
            // Azioni da eseguire quando si clicca su Prosegui
            console.log("Prosegui premuto");
            // Qui puoi inserire il codice per navigare a una nuova pagina o altro
        });
    });
        // Gestione navigazione con tasto Enter
        var inputBoxes = document.querySelectorAll('.input-lato');
        inputBoxes.forEach(function(input, index) {
            input.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault(); // Previene il comportamento di default del tasto Invio
                    // Passa al prossimo input box, se esiste
                    if (index < inputBoxes.length - 1) {
                        inputBoxes[index + 1].focus();
                    }
                }
            });
        });

        //gestion pulsante "carrello"
        var carrello = [];
        document.getElementById('btnAggiungiCarrello').addEventListener('click', function() {
            // Resetta gli stili dei campi in caso siano stati precedentemente marcato come mancanti
            document.querySelectorAll('.campoMancante').forEach(function(campo) {
                campo.classList.remove('campoMancante');
            });
            const viewportmeta = document.querySelector('meta[name=viewport]');
            viewportmeta.setAttribute('content', "initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0");
        
            var errori = [];
        
            var dropdown1 = document.getElementById('spessore');
            var dropdown2 = document.getElementById('materiale');
            var dropdown3 = document.getElementById('tipologia');
            var dropdown4 = document.getElementById('colore');
            var numPezzi = document.getElementById('numPezzi');
            var altezza = document.getElementById('altezza');
        
            [dropdown1, dropdown2, dropdown3, dropdown4, numPezzi, altezza].forEach(function(campo) {
                // Controlla se la dropdown è abilitata e se il valore è vuoto
                if (!campo.disabled && !campo.value) {
                    console.log("Campo vuoto trovato:", campo.id);
                    campo.classList.add('campoMancante');
                    errori.push(campo.getAttribute('id'));
                }
            });
        
            // Aggiungi la logica per applicare lo stile al genitore della casella di selezione
            [dropdown1, dropdown2, dropdown3, dropdown4].forEach(function(dropdown) {
                if (!dropdown.disabled && !dropdown.value) {
                    dropdown.parentNode.classList.add('campoMancante');
                }
            });
        
        
            // Controlla e marca le input delle misurazioni se sono vuote
            document.querySelector('.measure-section.' + profiloSelezionato).querySelectorAll('.input-lato').forEach(function(input) {
                if (input.value === '') {
                    input.classList.add('campoMancante');
                    errori.push("misurazione");
                }
            });
        
            if (errori.length > 0) {
                var messaggioErrore = "Per favore, completa i seguenti campi: " + errori.join(", ");
                alert(messaggioErrore);
                return;
            }
            
            // Procedi con il resto del codice per l'aggiunta al carrello
            html2canvas(document.querySelector('.measure-section.' + profiloSelezionato)).then(canvas => {
                var immagineDataUrl = canvas.toDataURL("image/png", 1.0); // Alta qualità

        
                var datiMisurazioni = {};
                document.querySelector('.measure-section.' + profiloSelezionato).querySelectorAll('.input-lato').forEach(function(input, index) {
                    if (input.value !== '') {
                        datiMisurazioni["Lato" + (index + 1)] = input.value;
                    }
                });
        
                var datiCarrello = {
                    profilo: profiloSelezionato,
                    immagineDataUrl: immagineDataUrl,
                    pezzi: numPezzi.value,
                    altezza: altezza.value,
                    spessore: dropdown1.value,
                    materiale: dropdown2.value,
                    tipologia: dropdown3.value,
                    colore: dropdown4.value,
                    datiMisurazioni: datiMisurazioni
                };
        
                carrello.push(datiCarrello);
                console.log("dati aggiunti: ", carrello);
        
                // Aggiorna il conteggio del carrello e resetta il pulsante e le input box
                document.getElementById('conteggioCarrello').textContent = carrello.length;
                var btn = document.getElementById('btnAggiungiCarrello');
                btn.textContent = 'Aggiunto!';
                setTimeout(function() {
                    btn.textContent = 'Aggiungi al Carrello';
                }, 2000);
        
                // Reset delle input box dopo aver salvato i dati
                document.querySelectorAll('#numPezzi, #altezza').forEach(function(input) {
                    input.value = '';
                });
            });
        });
        
        
        //mostra carrello
        document.getElementById('btnMostraCarrello').addEventListener('click', function() {
            // Nascondi le altre sezioni
            document.getElementById('profile-section').style.display = 'none';
            document.getElementById('input-section').style.display = 'none';
            document.getElementById('measureSection').style.display = 'none';
        
            // Funzione per aggiornare la visualizzazione del carrello
            function aggiornaVisualizzazioneCarrello() {
                var containerElementi = document.getElementById('elementiCarrello');
                containerElementi.innerHTML = ''; // Pulisce vecchi contenuti
        
                carrello.forEach(function(elemento, indice) {
                img = 'img\\' + elemento.immagineDataUrl
                console.log("img: ", img);
                var htmlProfilo = '<div class="elementoCarrello">' +
                    '<img src="'+ elemento.immagineDataUrl + '" alt="Profilo xto" class="imgCarrello">';  
            
        
                var dettagliHtml = '<div class="dettagliProfilo">';
        
                // Aggiungi le misure
                for (var misura in elemento.misurazioni) {
                    dettagliHtml += '<p>' + misura + ': ' + elemento.misurazioni[misura] + '</p>';
                }
        
                 // Aggiungi N. Pezzi e Altezza e altri dettagli
                dettagliHtml += '<p>N. Pezzi: ' + elemento.pezzi + '</p>';
                dettagliHtml += '<p>Altezza: ' + elemento.altezza + '</p>';
                dettagliHtml += '<p>Materiale: ' + elemento.materiale + '</p>';
                dettagliHtml += '<p>Spessore: ' + elemento.spessore + '</p>';
                dettagliHtml += '<p>Tipologia: ' + elemento.tipologia + '</p>';
                dettagliHtml += '<p>Colore: ' + elemento.colore + '</p>';
                dettagliHtml += '</div>'; // Chiusura del contenitore dettagliProfilo

                // Aggiungi un'icona di rimozione
                var iconaRimozioneHtml = '<span class="rimuovi-icona" data-indice="' + indice + '">&#10005;</span>';

                // Aggiungi l'icona di rimozione al profilo HTML
                var htmlProfilo = '<div class="elementoCarrello">' + iconaRimozioneHtml +
                                '<img src="' + elemento.immagineDataUrl + '" alt="Profilo xto" class="imgCarrello">' +
                                dettagliHtml + '</div>';

                containerElementi.innerHTML += htmlProfilo;
            });
        
            // Mostra la sezione del carrello
            document.getElementById('dettagliCarrello').style.display = 'block';

                // Aggiungi event listener per le icone di rimozione
            document.querySelectorAll('.rimuovi-icona').forEach(function(icona) {
                icona.addEventListener('click', function() {
                    var indice = this.getAttribute('data-indice');
                    if (confirm('Confermi la rimozione dell\'elemento dal carrello?')) {
                        carrello.splice(indice, 1);
                        aggiornaVisualizzazioneCarrello(); // Aggiorna nuovamente la visualizzazione del carrello
                        aggiornaBadgeCarrello(); // Aggiorna il badge del carrello
                    }
                });
            });
        }

        // Inizialmente popola la visualizzazione del carrello
        aggiornaVisualizzazioneCarrello();
        aggiornaBadgeCarrello(); // Aggiorna il badge del carrello
    });
        
         // Aggiungi event listener per le icone di rimozione
            document.querySelectorAll('.rimuovi-icona').forEach(function(icona) {
                icona.addEventListener('click', function() {
                    var indice = this.getAttribute('data-indice');
                    if (confirm('Confermi la rimozione dell\'elemento dal carrello?')) {
                        // Rimuovi l'elemento dal carrello
                        carrello.splice(indice, 1);

                        // Aggiorna la visualizzazione del carrello
                        // Qui puoi chiamare nuovamente la funzione di visualizzazione del carrello o aggiornare direttamente il DOM
                    }
                });
            });
       

        function getUrlImmagine(profilo) {
            // Restituisci l'URL dell'immagine in base al nome del profilo
            // Ad esempio:
            return  profilo + '.png'; // Modifica in base alla tua struttura di file
        }
        
        document.getElementById('btnAggiungiElementi').addEventListener('click', function() {
            // Nascondi la sezione del carrello
            document.getElementById('dettagliCarrello').style.display = 'none';
        
            // Mostra le sezioni per aggiungere nuovi elementi
            document.getElementById('profile-section').style.display = 'block';
            document.getElementById('input-section').style.display = 'block';
            document.getElementById('measureSection').style.display = 'block';
            // ... altre sezioni da mostrare se necessario ...
        });
        
        document.getElementById('downloadButton').addEventListener('click', function() {
            // Qui puoi implementare la logica per lo sviluppo o la visualizzazione di ulteriori dettagli
            console.log("downloadButton cliccato");
        });
            


    document.getElementById('downloadButton').addEventListener('click', function() {
        html2canvas(document.getElementById('elementiCarrello')).then(function(canvas) {
            // Converti il canvas in un'immagine
            var image = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
            
            // Crea un elemento di ancoraggio per il download
            var downloadLink = document.createElement('a');
            downloadLink.href = image;
            downloadLink.download = 'immagine.png';
            
            // Simula il clic sull'elemento di ancoraggio
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
        });
    });

    document.getElementById('btnInviaOrdine').addEventListener('click', function() {
        var nomeCliente = document.querySelector('.input1').value;
        var riferimentoOrdine = document.querySelector('.input2').value;
        var oggettoEmail = "Ordine Inventory - " + nomeCliente + " - " + riferimentoOrdine;
        var corpoEmail = "Nuovo Ordine Inventory confermato da " + nomeCliente + ". Dettagli in allegato. Si prega di ricontattare " + nomeCliente + " per conferma lavorazione.";
    
        // Converti il canvas in immagine
       // var canvas = document.querySelector('.measure-section.' + profiloSelezionato + ' canvas');
       // var immagineDataUrl = canvas.toDataURL("image/png");
    
        // Qui devi inviare i dati al tuo server o servizio di email
        // Assicurati che il tuo server gestisca l'invio dell'email con l'immagine allegata
        //inviaEmail(oggettoEmail, corpoEmail, immagineDataUrl);
    
        // Apri il link di condivisione WhatsApp
        apriLinkWhatsApp(nomeCliente,riferimentoOrdine);
    });
    
    function apriLinkWhatsApp(nomeCliente,riferimentoOrdine) {
        var messaggioWhatsApp = encodeURIComponent("Ciao, ti condivido l'ordine che ho effettuato:"+riferimentoOrdine+". Nome Cliente: "+nomeCliente);
        var urlWhatsApp = `https://wa.me/?text=${messaggioWhatsApp}`;
        window.open(urlWhatsApp, '_blank');
    }

    document.getElementById('btnSviluppo').addEventListener('click', function() {
        var nomeCliente = document.querySelector('.input1').value;
        var riferimentoOrdine = document.querySelector('.input2').value;
        var dataOdierna = new Date().toLocaleDateString();
        
            // Ordina il carrello prima di raggrupparlo
        carrello.sort(function(a, b) {
            // Confronta per Materiale
            if (a.materiale < b.materiale) return -1;
            if (a.materiale > b.materiale) return 1;

            // Confronta per Tipologia
            if (a.tipologia < b.tipologia) return -1;
            if (a.tipologia > b.tipologia) return 1;

            // Confronta per Colore
            if (a.colore < b.colore) return -1;
            if (a.colore > b.colore) return 1;

            // Confronta per Spessore
            if (a.spessore < b.spessore) return -1;
            if (a.spessore > b.spessore) return 1;

            return 0; // Se tutti i criteri sono uguali
        });
        // Raggruppa gli elementi per materiale e poi per profilo e misurazioni
        var materialeGruppi = {};

            // Estrai combinazioni uniche
            var combinazioniUniche = {};
            carrello.forEach(function(elemento) {
                var chiaveCombinazione = getElementoChiaveCombinazione(elemento); // Funzione per determinare la chiave
                if (!combinazioniUniche[chiaveCombinazione]) {
                    combinazioniUniche[chiaveCombinazione] = { somma: 0, descrizione: chiaveCombinazione };
                }
                var sommaMisurazioni = Object.values(elemento.datiMisurazioni).reduce((acc, val) => acc + parseFloat(val), 0);
                combinazioniUniche[chiaveCombinazione].somma += elemento.pezzi * elemento.altezza * sommaMisurazioni;
            });

        // Calcola il numero di colonne e righe per la griglia
        var numeroCombinazioni = Object.keys(combinazioniUniche).length;
        var colonne = Math.ceil(Math.sqrt(numeroCombinazioni));
        var righe = Math.ceil(numeroCombinazioni / colonne);
        var pesoTotale = 0;
        carrello.forEach(function(elemento) {
            var materialeFittizio = "MaterialeUnico"; // Valore fittizio
            var chiaveProfiloMisurazione = `${materialeFittizio}-${elemento.profilo}-${JSON.stringify(elemento.datiMisurazioni)}-${elemento.materiale}-${elemento.tipologia}-${elemento.spessore}-${elemento.colore || ''}`;
            pesoTotale += calcolaPesoTeorico(elemento.materiale, elemento.spessore);
            if (!materialeGruppi[materialeFittizio]) {
                materialeGruppi[materialeFittizio] = {};
            }
            if (!materialeGruppi[materialeFittizio][chiaveProfiloMisurazione]) {
                materialeGruppi[materialeFittizio][chiaveProfiloMisurazione] = {
                    elementi: [],
                    datiMisurazioni: elemento.datiMisurazioni,
                    profilo: elemento.profilo,
                    // Aggiungi le nuove proprietà per il raggruppamento
                    materiale: elemento.materiale,
                    tipologia: elemento.tipologia,
                    spessore: elemento.spessore,
                    colore: elemento.colore || ''  // Gestisce il caso in cui colore non è disponibile
            };
            }
            materialeGruppi[materialeFittizio][chiaveProfiloMisurazione].elementi.push(elemento);
        });
    
        var finestraStampa = window.open('', '_blank');
        if (finestraStampa) {
            finestraStampa.document.write('<html><head><title>Dettagli Ordine</title><style>');
      

            finestraStampa.document.write('.container { border: 1px solid black; width: 210mm; height: 297mm; display: flex; flex-direction: column; align-items: flex-start; justify-content: flex-start; }');
            finestraStampa.document.write('.elemento { display: flex; flex-direction: column; align-items: center; width: 49%; margin: 1px; border: 1px solid black; }'); // Layout in colonna per .elemento
            finestraStampa.document.write('.content { display: flex; flex-direction: row; width: 100%; }'); // Stile per .content
            finestraStampa.document.write('.dettagli-container { display: flex; flex-direction: column; width: 50%; }'); // Stile per .dettagli-container
            finestraStampa.document.write('.info-section { width: 100%; text-align: center; border-top: 1px solid gray; }'); // Stile per .info-section
      
            finestraStampa.document.write('.dettagli { margin: 1px; }'); // Stile per .dettagli
            finestraStampa.document.write('.elemento img { width: 100%; height: auto; max-height: 100%; }'); // Imposta max-height in percentuale
       
          
            
            finestraStampa.document.write('.header-info { display: flex; justify-content: space-between; width: 100%; margin-bottom: 10px; }');
            finestraStampa.document.write('.row { display: flex; width: 100%; justify-content: space-around; flex-wrap: wrap; }');
          
    
            finestraStampa.document.write('</style></head><body>');

            for (var materiale in materialeGruppi) {
                finestraStampa.document.write('<div class="container">');
                finestraStampa.document.write('<div class="header-info" style="font-weight: bold;"><span>Data: ' + dataOdierna + '</span><span>Cliente: ' + nomeCliente + '</span><span>Riferimento Ordine: ' + riferimentoOrdine + '</span></div>');
               

              
    
                var profiliMisurazioniGruppi = materialeGruppi[materiale];
                var elementoContatore = 0;
    
                for (var chiaveProfiloMisurazione in profiliMisurazioniGruppi) {
                    var gruppo = profiliMisurazioniGruppi[chiaveProfiloMisurazione];
                    var percentualeAltezza = 100 / gruppo.elementi.length;
                     // Ordina gli elementi del gruppo per altezza, dal maggiore al minore
                    gruppo.elementi.sort((a, b) => b.altezza - a.altezza);

                    if (elementoContatore % 2 === 0) {
                        finestraStampa.document.write('<div class="row">');
                    }
                    
                    finestraStampa.document.write('<div class="elemento">');
                        finestraStampa.document.write('<div class="content">'); // Nuovo div .content
                        finestraStampa.document.write('<img src="' + gruppo.elementi[0].immagineDataUrl + '" style="width: 50%;">'); // Immagine
                        finestraStampa.document.write('<div class="dettagli-container">'); // Container per i dettagli

                        if (gruppo.materiale === "Alluminio" && gruppo.tipologia === "Verniciato") {
                            var infoSectionContent = `${gruppo.materiale} ${gruppo.colore}`;    
                        } else {
                            var infoSectionContent = `${gruppo.materiale} ${gruppo.spessore} ${gruppo.tipologia} ${gruppo.colore}`;    
                        }
                    
                

                       
                        gruppo.elementi.forEach(function(elemento) {
                            var sommaMisurazioni = Object.values(elemento.datiMisurazioni).reduce((acc, val) => acc + parseFloat(val), 0);
        
                            finestraStampa.document.write('<div class="dettagli">');
                            finestraStampa.document.write('<p>N.'+elemento.pezzi+' ' + elemento.altezza + ' x ' + sommaMisurazioni + '</p>');
                        
                            finestraStampa.document.write('</div>'); // Chiusura dei div 'dettagli'
                        });
        
                        finestraStampa.document.write('</div>'); // Chiusura di .dettagli-container
                        finestraStampa.document.write('</div>'); // Chiusura di .content
                        finestraStampa.document.write('<div class="info-section">' + infoSectionContent + '</div>');
                        
                        finestraStampa.document.write('</div>'); // Chiusura di .elemento
            
    
                    elementoContatore++;
    
                    if (elementoContatore % 2 === 0 || elementoContatore === Object.keys(profiliMisurazioniGruppi).length) {
                        finestraStampa.document.write('</div>'); // Close the row
                    }
                }
                
                // Aggiungi stile CSS per il footer
                     finestraStampa.document.write('<div class="footer" style="grid-template-columns: repeat(' + colonne + ', 1fr); grid-template-rows: repeat(' + righe + ', 1fr);">');
                    Object.values(combinazioniUniche).forEach(function(combinazione) {
                        var pesoFinale = pesoTotale * (combinazione.somma/1000);
                        pesoFinale=pesoFinale.toFixed(2);
                        finestraStampa.document.write('<div class="footer-cell">' + combinazione.descrizione + ' - Peso teorico: ' + pesoFinale + ' kg</div>');
                    });
                        if (elementoContatore % 2 === 0 || elementoContatore === Object.keys(profiliMisurazioniGruppi).length) {
                            finestraStampa.document.write('</div>'); // Close the row
                        }
                       
                        finestraStampa.document.write('</div>'); // Chiusura del footer
                        finestraStampa.document.write('<style>');
                        finestraStampa.document.write('.footer { display: grid; width: 100%; }');
                        finestraStampa.document.write('.footer-cell { border: 1px solid black; padding: 10px; }');
                        finestraStampa.document.write('</style>');;
                
                        
                finestraStampa.document.write('</div>'); // Close the container
            }
               
            finestraStampa.document.write('</body></html>');
            finestraStampa.document.close();
            finestraStampa.focus();
 
            } else {
                console.error('Impossibile aprire la finestra di stampa.');
        }
    });

  

    function getElementoChiaveCombinazione(elemento) {
        if (elemento.materiale === "Alluminio" && elemento.tipologia === "Verniciato") {
            return `${elemento.materiale} ${elemento.colore}`;
        } else {
            return `${elemento.spessore} ${elemento.materiale} ${elemento.tipologia} ${elemento.colore}`;
        }
    }

    function calcolaPesoTeorico(materiale, spessore) {
        if (materiale === "Ferro") {
            switch(spessore) {
                case "20/10": return 0.016;
                case "15/10": return 0.012;
                case "10/10": return 0.008;
                default: return 0; // Valore predefinito se lo spessore non corrisponde
            }
        } else if (materiale === "Alluminio") {
            return 0.026;
        } else {
            return 0; // Valore predefinito per altri materiali
        }
    }
    

    
        
</script>

</body>

</html>
