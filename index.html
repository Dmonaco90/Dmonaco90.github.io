<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="stile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    
</head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>


<body>
<button id="btnMostraCarrello">
    <i class="fa fa-shopping-cart"></i>
    <span id="conteggioCarrello" class="badge">0</span>
</button>
<div class="header">
    <h1>Monaco's Inventory</h1>
</div>
<div class="input-container">
    <input type="text" class="input1" placeholder="Nome Cliente">
    <input type="text" class="input2" placeholder="Riferimento Ordine">
</div>

<div class="profile-section" id="profile-section">
    <h2>Scegli Profilo</h2>
    <div class="profile-grid">
        <!-- Ripeti questo blocco per 30 volte, cambia l'URL dell'immagine di sfondo per ciascun quadrato -->
        <div class="profile" style="background-image: url('img\\zeta2.png');" data-target="zeta"></div>
        <div class="profile" style="background-image: url('img\\omega.png');"data-target="omega"></div>
        <div class="profile" style="background-image: url('img\\Ami.png');"data-target="Ami"></div>
        <div class="profile" style="background-image: url('img\\Amo.png');"data-target="Amo"></div>
        <div class="profile" style="background-image: url('img\\gancio.png');"data-target="gancio"></div>
        <div class="profile" style="background-image: url('img\\L.png');"data-target="L"></div>
        <div class="profile" style="background-image: url('img\\OmegaAsi.png');" data-target="OmegaAsi"></div>
        <div class="profile" style="background-image: url('img\\OmegaInt.png');"data-target="OmegaInt"></div>
        <div class="profile" style="background-image: url('img\\u.png');"data-target="u"></div>
        <div class="profile" style="background-image: url('img\\Linea.png');"data-target="Linea"></div>
        <div class="profile" style="background-image: url('img\\OmegaAsi2.png');" data-target="OmegaAsi2"></div>
        <div class="profile" style="background-image: url('img\\LineaAngolare.png');"data-target="LineaAngolare"></div>
        <div class="profile" style="background-image: url('img\\omega5.png');"data-target="omega5"></div>
        <div class="profile" id="libero"style="background-image: url('img\\libero.png');"data-target="libero"></div>
    </div>
</div>


<div class="measure-section2" id="measureSection">

    <div class="flex-container">
        <div class="measure-section zeta" id="drawSection">
            <div class="image-container">
                <img src="img\zeta2.png" alt="zeta">
                <input type="number" class="input-lato lato-zeta" id="lato1-zeta" style="top: 8%; left: 10%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-zeta" id="lato2-zeta" style="top: 82%; left: 69%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-zeta" id="lato3-zeta" style="top: 47%; right: 52%; width: 20px" placeholder="x">
                <div class="scelteVerniciato" style="display: none;">
                    <img src="img/freccia_interna.png" class="opzioneVerniciato" id="scelta1" style="position: absolute;  margin: 0; width: auto; top: 63%; left: 50%;">
                    <img src="img/freccia_esterna.png" class="opzioneVerniciato" id="scelta2" style="position: absolute;  margin: 0; width: auto; top: 19%; left: 37%;">
                 </div>
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section u" id="drawSection">
            <div class="image-container">
                <img src="img\u.png" alt="u">
                <input type="number" class="input-lato lato-u" id="lato1-u" style="top: 45%; left: 12%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-u" id="lato2-u" style="top: 65%; left: 50%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-u" id="lato3-u" style="top: 45%; right: 1%; width: 20px;" placeholder="x">
                <div class="scelteVerniciato" style="display: none;">
                    <img src="img/freccia_interna.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 44%; left: 26%;">
                    <img src="img/freccia_esterna.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 55%; left: 13%;">
                 </div>
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section omega5" id="drawSection">
            <div class="image-container">
                <img src="img\omega5.png" alt="u">
                <input type="number" class="input-lato lato-omega5" id="lato1-Omega5" style="top: 25%; left: 25%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-omega5" id="lato1-Omega5" style="top: 25%; right: 25%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-Omega5" id="lato2-Omega5" style="top: 75%; left: 47%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-Omega5" id="lato3-Omega5" style="top: 59%; right: 10%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-Omega5" id="lato3-Omega5" style="top: 59%; left: 10%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-Omega5" id="lato3-Omega5" style="top: 64%; right: 23%; width: 20px; text-align:center;" placeholder="x">
                <input type="number" class="input-lato lato-Omega5" id="lato3-Omega5" style="top: 64%; left: 24%; width: 20px;text-align:right;" placeholder="x">
                <input type="number" class="input-lato lato-Omega5" id="lato3-Omega5" style="top: 40%; left: 1%; width: 20px;text-align:right;" placeholder="x">
                <input type="number" class="input-lato lato-Omega5" id="lato3-Omega5" style="top: 40%; right: 1%; width: 20px;" placeholder="x">
                <div class="scelteVerniciato" style="display: none;">
                    <img src="img/freccia_interna.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 22%; left: 83%;">
                    <img src="img/freccia_esterna.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 35%; left: 69%;">
                 </div>
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section LineaAngolare" id="drawSection">
            <div class="image-container">
                <img src="img\LineaAngolare.png" alt="u">
                <input type="number" class="input-lato lato-LineaAngolare" id="lato1-LineaAngolare" style="top: 43%; right: 29%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-LineaAngolare" id="lato2-LineaAngolare" style="top: 48%; left: 42%; width: 20px;" placeholder="x">
                 <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
                 <div class="scelteVerniciato" style="display: none;">
                    <img src="img/freccia_interna2.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 41%; left: 25%;">
                    <img src="img/freccia_esterna2.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 59%; left: 58%;">
                 </div>
            </div>
        </div>

        <div class="measure-section OmegaAsi2" id="drawSection">
            <div class="image-container">
                <img src="img\OmegaAsi2.png" alt="u">
                <input type="number" class="input-lato lato-OmegaAsi2" id="lato1-OmegaAsi2" style="top: 29%; right: 8%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi2" id="lato2-OmegaAsi2" style="top: 33%; right: 27%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi2" id="lato3-OmegaAsi2" style="top: 55%; right: 8%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi2" id="lato1-OmegaAsi2" style="top: 55%; left: 12%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi2" id="lato2-OmegaAsi2" style="top: 68%; left: 47%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi2" id="lato3-OmegaAsi2" style="top: 39%; right: 18%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi2" id="lato3-OmegaAsi2" style="top: 10%; right: 20%; width: 20px;" placeholder="x">
                <div class="scelteVerniciato" style="display: none;">
                    <img src="img/freccia_interna2.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 47%; left: 25%;">
                    <img src="img/freccia_esterna2.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 62%; left: 58%;">
                 </div>
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section L" id="drawSection">
            <div class="image-container">
                <img src="img\L.png" alt="L">

                <input type="number" class="input-lato lato-L" id="lato2-L" style="top: 50%; left: 6%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-L" id="lato3-L" style="top: 75%; right: 35%; width: 20px;" placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
                <div class="scelteVerniciato" style="display: none;">
                    <img src="img/freccia_interna.png" class="opzioneVerniciato" id="scelta111" style="position: absolute;  margin: 0; width: auto; top: 49%; left: 21%;">
                    <img src="img/freccia_esterna.png" class="opzioneVerniciato" id="scelta222" style="position: absolute;  margin: 0; width: auto; top: 62%; left: 7%;">
                 </div>

            </div>
        </div>

        <div class="measure-section Linea" id="drawSection">
            <div class="image-container">
                <img src="img\Linea.png" alt="Linea">

                <input type="number" class="input-lato lato-Linea" id="lato2-Linea" style="top: 40%; left: 50%; width: 20px;" placeholder="x">

                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section omega" id="drawSection">
            <div class="image-container">
                <img src="img\omega.png" alt="omega">
                <input type="number" class="input-lato lato-omega" id="lato1-omega" style="top: 20%; left: 10%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-omega" id="lato2-omega" style="top: 75%; left: 52%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-omega" id="lato3-omega" style="top: 20%; right: 5%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-omega" id="lato4-omega" style="top: 50%; right: 10%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-omega" id="lato5-omega" style="top: 50%; left: 22%; width: 20px;" placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
                <div class="scelteVerniciato" style="display: none;">
                    <img src="img/freccia_interna.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 52%; left: 35%;">
                    <img src="img/freccia_esterna.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 64%; left: 22%;">
                 </div>
            </div>
        </div>

        <div class="measure-section OmegaAsi" id="drawSection">
            <div class="image-container">
                <img src="img\OmegaAsi.png" alt="u">
                <input type="number" class="input-lato lato-OmegaAsi" id="lato1-OmegaAsi" style="top: 12%; left: 38%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi" id="lato2-OmegaAsi" style="top: 80%; left: 38%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi" id="lato3-OmegaAsi" style="top: 61%; right: 1%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi" id="lato4-OmegaAsi" style="top: 47%; left: 15%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi" id="lato5-OmegaAsi" style="top: 61%; left: 52%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaAsi" id="lato6-OmegaAsi" style="top: 30%; right: 30%; width: 20px;" placeholder="x">
                <div class="scelteVerniciato" style="display: none;">
                    <img src="img/freccia_interna.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 60%; left: 33%;">
                    <img src="img/freccia_esterna.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 72%; left: 20%;">
                 </div>
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section OmegaInt" id="drawSection">
            <div class="image-container">
                <img src="img\OmegaInt.png" alt="OmegaInt">
                <input type="number" class="input-lato lato-OmegaInt" id="lato1-OmegaInt" style="top: 25%; left: 20%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaInt" id="lato2-OmegaInt" style="top: 80%; left: 50%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaInt" id="lato3-OmegaInt" style="top: 25%; right: 15%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaInt" id="lato4-OmegaInt" style="top: 50%; right: 1%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-OmegaInt" id="lato5-OmegaInt" style="top: 50%; left: 3%; width: 20px;" placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
                <div class="scelteVerniciato" style="display: none;">
                    <img src="img/freccia_interna.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 58%; left: 15%;">
                    <img src="img/freccia_esterna.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 69%; left: 4%;">
                 </div>
            </div>
        </div>

        <div class="measure-section Amo" id="drawSection">
            <div class="image-container">
                <img src="img\Amo.png" alt="Amo">
                <input type="number" class="input-lato lato-Amo" id="lato1-Amo" style="top: 32%; left: 15%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-Amo" id="lato2-Amo" style="top: 65%; left: 50%; width: 20px;" placeholder="x">
                <div class="scelteVerniciato" style="display: none;">
                    <img src="img/freccia_interna.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 45%; left: 14%;">
                    <img src="img/freccia_esterna.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 55%; left: 2%;">
                 </div>
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
            </div>
        </div>

        <div class="measure-section Ami" id="drawSection">
            <div class="image-container">
                <img src="img\Ami.png" alt="Ami">
                <input type="number" class="input-lato lato-Ami" id="lato1-Ami" style="top: 32%; left: 22%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-Ami" id="lato2-Ami" style="top: 60%; left: 48%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-Ami" id="lato3-Ami" style="top: 32%; right: 18%; width: 20px;" placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
                <div class="scelteVerniciato" style="display: none;">
                    <img src="img/freccia_interna2.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 34%; left: 36%;">
                    <img src="img/freccia_esterna2.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 49%; left: 51%;">
                 </div>
            </div>
        </div>

        <div class="measure-section gancio" id="drawSection">
            <div class="image-container">
                <img src="img\gancio.png" alt="gancio">
                <input type="number" class="input-lato lato-gancio" id="lato1-gancio" style="top: 28%; left: 30%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-gancio" id="lato2-gancio" style="top: 70%; left: 50%; width: 20px;" placeholder="x">
                <input type="number" class="input-lato lato-gancio" id="lato3-gancio" style="top: 50%; left: 15%; width: 20px;" placeholder="x">
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
                <div class="scelteVerniciato" style="display: none;">
                    <img src="img/freccia_interna.png" class="opzioneVerniciato" id="scelta11" style="position: absolute;  margin: 0; width: auto; top: 47%; left: 27%;">
                    <img src="img/freccia_esterna.png" class="opzioneVerniciato" id="scelta21" style="position: absolute;  margin: 0; width: auto; top: 58%; left: 16%;">
                 </div>
            </div>
        </div>

        <div class="measure-section libero" id="drawSection">
            <div class="image-container" id="drawSection-libero">
                
                <div id="toolbar">
                    <button id="pencil"><i class="fa fa-pencil-alt"></i></button>
                    <button id="eraser"><i class="fa fa-trash"></i></button>
                    <button id="dimension">Quota</button>
                    <!--<button id="deleteDimensions"><i class="fa fa-trash"></i></button>-->
                    <button id="eraserTool" title="Undo"><i class="fa fa-undo"></i></button>
                </div>
                <div id="drawingCanvasParent" style="position: relative;">
                    <canvas id="drawingCanvas" ></canvas>
                </div>
                <!-- Aggiungi altri input box come necessario, posizionandoli con lo stile inline -->
                
            </div>
        </div>
        
        
        <div class="dropdown-container">
            <div class="dropdown-menus">
                <select id="materiale" class="dropdown">
                    <option value="" disabled selected hidden>Materiale</option>
                    <option value="Alluminio">Alluminio</option>
                    <option value="Ferro">Ferro</option>
                    <option value="Acciaio">Acciaio</option>
                </select>
            </div>
            <div class="dropdown-menus">
                <select id="tipologia" class="dropdown" disabled>
                    <option value="" disabled selected hidden>Tipologia</option>
                </select>
            </div>
            <div class="dropdown-menus">
                <select id="spessore" class="dropdown" disabled>
                    <option value="" disabled selected hidden>Spessore</option>
                </select>
            </div>
            <div class="dropdown-menus">
                <select id="colore" class="dropdown" disabled>
                    <option value="" disabled selected hidden>Colore</option>
                </select>
            </div>
        </div>
    </div>
    


    <div class="input-section" id="input-section">
        <div>
            <input type="number" id="numPezzi" style="width: 50px;" placeholder="N. Pezzi">
            <input type="number" id="altezza" style="width: 50px;" placeholder="Altezza">
            <button id="btnAggiungiCarrello">Aggiungi al Carrello</button>
           
        </div>
    </div>
</div>
<div class="risultatiSviluppo" id="risultatiSviluppo" style="display: none;">
  
    <button id="btnTornaIndietro">Torna Indietro</button>
    <button id="btnProsegui">Prosegui</button>
</div>

<div id="dettagliCarrello" style="display: none;">
    <h2>Contenuto del Carrello</h2>
    <div id="elementiCarrello">
        <!-- Dettagli degli elementi del carrello qui -->
    </div>
    <button id="btnAggiungiElementi">Aggiungi Altro</button>
    <button id="downloadButton">Scarica Ordine</button>
    <button id="btnInviaOrdine">Invia Ordine e Condividi</button>
    <button id="btnSviluppo">Sviluppo</button> 
</div>



<script>


    var materialeDropdown = document.getElementById('materiale');
    var tipologiaDropdown = document.getElementById('tipologia');
    var spessoreDropdown = document.getElementById('spessore');
    var coloreDropdown = document.getElementById('colore');
    

    window.addEventListener('resize', handleResize);


   document.querySelectorAll('.input-box').forEach(input => {
        input.addEventListener('blur', () => {
            restoreCanvas(lastState.canvasState);
            restoreInputs(lastState.inputsState);
            drawGrid();
        });
    });
    materialeDropdown.addEventListener('change', function() {
        var materialeSelezionato = this.value;
        aggiornaTipologia(materialeSelezionato);

    });
    
    tipologiaDropdown.addEventListener('change', function() {
        var tipologiaSelezionata = this.value;
        aggiornaSpessoreColore(materialeDropdown.value, tipologiaSelezionata);

    });
    
    function aggiornaBadgeCarrello() {
        var conteggio = carrello.length;
        document.getElementById('conteggioCarrello').textContent = conteggio;
    }

    function resetColoreDropdown() {
        // Resetta la dropdown del colore al suo stato iniziale
        coloreDropdown.innerHTML = '';
        var opzioneVuota = document.createElement('option');
        opzioneVuota.textContent = "Colore";
        opzioneVuota.value = "";
        opzioneVuota.disabled = true;
        opzioneVuota.selected = true;
        opzioneVuota.hidden = true;
        coloreDropdown.appendChild(opzioneVuota);
        coloreDropdown.disabled = true;
    }

    function aggiornaTipologia(materiale) {
        var opzioniTipologia;
        if (materiale === 'Alluminio') {
            opzioniTipologia = ['Grezzo', 'Verniciato'];
        } else if (materiale === 'Ferro') {
            opzioniTipologia = ['Zincata', 'SPO', 'Nera'];
        } else if (materiale === 'Acciaio') {
            opzioniTipologia = ['Satinato', 'Lucido', 'S.B', 'Grezzo'];
        }
        aggiornaDropdown(tipologiaDropdown, opzioniTipologia);
    }
    
    function aggiornaSpessoreColore(materiale, tipologia) {
        var opzioniSpessore, opzioniColore;
        
        if (materiale === 'Alluminio') {
            if (tipologia === 'Grezzo') {
                resetColoreDropdown();  // Resetta il colore dopo il cambio di materiale
                opzioniSpessore = ['10/10', '15/10', '20/10', '30/10'];
                coloreDropdown.disabled = true;
            } else if (tipologia === 'Verniciato') {
                opzioniSpessore = ['12/10'];
                opzioniColore = ['Bianco', 'Nero', 'Avorio', 'Bianco Opaco', 'Grigio Scuro', 'Grigio Chiaro', 'Grigio Raf.', 'Verde Raf.', 'Verde', 'Bronzo', 'Argento ox', 'Argento Verniciato'];
                aggiornaDropdown(coloreDropdown, opzioniColore);
                coloreDropdown.disabled = false;
            }
        } else if (materiale === 'Ferro') {
            resetColoreDropdown();  // Resetta il colore dopo il cambio di materiale
            opzioniSpessore = ['8/10', '10/10', '12/10', '15/10', '20/10', '25/10', '30/10', '40/10', '50/10', '60/10', '80/10', '100/10'];
            coloreDropdown.disabled = true;
        } else if (materiale === 'Acciaio') {
            resetColoreDropdown();  // Resetta il colore dopo il cambio di materiale
            opzioniSpessore = ['8/10', '10/10', '15/10', '20/10', '30/10'];
            coloreDropdown.disabled = true;
        }
    
        aggiornaDropdown(spessoreDropdown, opzioniSpessore);
    }
    
    function aggiornaDropdown(dropdown, opzioni) {
        dropdown.innerHTML = '';
        var opzioneVuota = document.createElement('option');
        opzioneVuota.value = "";
        opzioneVuota.disabled = true;
        opzioneVuota.selected = true;
        opzioneVuota.hidden = true;
    
        // Imposta il testo del placeholder in base all'ID del dropdown
        if (dropdown.id === 'tipologia') {
            opzioneVuota.textContent = "Tipologia";
        } else if (dropdown.id === 'spessore') {
            opzioneVuota.textContent = "Spessore";
        } else if (dropdown.id === 'colore') {
            opzioneVuota.textContent = "Colore";
        }
    
        dropdown.appendChild(opzioneVuota);
    
        opzioni.forEach(function(opzione) {
            var elemento = document.createElement('option');
            elemento.textContent = opzione;
            elemento.value = opzione;
            dropdown.appendChild(elemento);
        });
    
        dropdown.disabled = false;
    }
    

  

    var profiloSelezionato = null;
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.profile').forEach(function(profile) {
            profile.addEventListener('click', function() {
                var targetClass = this.getAttribute('data-target');
                profiloSelezionato = targetClass;
                if (profiloSelezionato === 'libero') {
                   
                    initializeCanvas();
                }
                // Nascondi tutte le sezioni
                document.querySelectorAll('.measure-section').forEach(function(section) {
                    section.style.display = 'none';
                });

                // Mostra la sezione corrispondente
                var targetSection = document.querySelector('.' + targetClass);
                console.log("targetClass:", targetClass);
                console.log("targetSection:", targetSection);
                if (targetSection) {
                    targetSection.style.display = 'flex';
                    document.querySelectorAll('.dropdown-container').forEach(function(element) {
                        element.style.display = 'flex';
                    });

                    resetScelteVerniciato();
            }

            
            targetSection.scrollIntoView();

                });
        });
    
        // Gestione click su pulsante Torna Indietro
        document.getElementById('btnTornaIndietro').addEventListener('click', function() {
            // Nasconde la sezione dei risultati
            document.getElementById('risultatiSviluppo').style.display = 'none';

            // Mostra la sezione dei profili e la sezione di misura
            document.getElementById('profile-section').style.display = 'block';
            document.getElementById('measureSection').style.display = 'block';

            // Opzionale: rimuovere la classe active-section
            var activeSections = document.querySelectorAll('.measure-section.active-section');
            activeSections.forEach(function(section) {
                section.classList.remove('active-section');
            });
        });

        document.getElementById('btnProsegui').addEventListener('click', function() {
            // Azioni da eseguire quando si clicca su Prosegui
            console.log("Prosegui premuto");
            // Qui puoi inserire il codice per navigare a una nuova pagina o altro
        });
      
        const canvas = document.getElementById('drawingCanvas');
        resizeCanvas(); // Imposta le dimensioni iniziali
        window.addEventListener('resize', resizeCanvas); // Gestisci i cambiamenti di dimensione

    });
    
    function resizeCanvas() {
        const parentDiv = document.getElementById('drawingCanvasParent');
        canvas.width = parentDiv.offsetWidth;
        canvas.height = parentDiv.offsetHeight;
    }
    //Inizio disegno libero

    let ctx;
    let StartX;
    let StartY;
    const canvas = document.getElementById('drawingCanvas');
    const drawSection = document.getElementById('drawSection');
    const gridSize = 20;
    let isDrawing = false, isDimensioning = false, lastX = 0, lastY = 0, isErasing = false;
    document.getElementById('pencil').addEventListener('click', () => {
        isDrawing = true;
        isErasing = false;
        isDimensioning = false;
        ctx.strokeStyle = '#000000'; // Colore delle linee del disegno
        ctx.lineWidth = 2; // Spessore delle linee
        ctx.globalCompositeOperation = 'source-over'; // Imposta la modalità di disegno normale
        updateButtonStyles();
    });

    document.getElementById('eraserTool').addEventListener('click', () => {
        isErasing = true;
        isDrawing = false;
        isDimensioning = false;
        
        undo();
    });

    document.getElementById('dimension').addEventListener('click', () => {
        isDimensioning = !isDimensioning;
        isDrawing = false; // Disabilita il disegno quando si passa alla quotatura
        isErasing = false; // Disabilita la gomma
        updateButtonStyles();
    });

    document.getElementById('eraser').addEventListener('click', () => {
        clearCanvas(); // Questa funzione pulisce il canvas
        removeDimensions(); // Questa funzione rimuove tutte le quote
        document.getElementById('pencil').click(); // Simula il clic sul pulsante "Matita"
    });

    //document.getElementById('deleteDimensions').addEventListener('click', removeDimensions);

    // Event listeners per il canvas
    canvas.addEventListener('mousedown', (e) => {
        if (isDimensioning) {
            addInputBox(e.offsetX, e.offsetY);
        } else {
            StartX = e.offsetX;
            StartY = e.offsetY;
            isDrawing = true;
            lastX = e.offsetX;
            lastY = e.offsetY;
        }
    });

    canvas.addEventListener('mousemove', (e) => {
        if (!isDrawing) return;
        [lastX, lastY] = getPosition(e); // Traccia solo le coordinate
    });

    canvas.addEventListener('mouseup', () => {
        if (isErasing) {
            drawGrid(); // Ridisegna la griglia
        }
        if (isDrawing) {
            drawLineFromStartToEnd();
            StartX = lastX;
            StartY = lastY;
        }
        isDrawing = false;
        ctx.lineWidth = 2; // Ripristina la larghezza della linea per il disegno
    });

    canvas.addEventListener('mouseout', stopDrawing);
    canvas.addEventListener('touchstart', handleTouchStart);
    canvas.addEventListener('touchmove', (e) => {
        if (!isDrawing) return;
        [lastX, lastY] = getPosition(e); // Traccia solo le coordinate
    });
    canvas.addEventListener('touchend', () => {
        if (isErasing) {
            drawGrid(); // Ridisegna la griglia
        }
        if (isDrawing) {
            drawLineFromStartToEnd();
            StartX = lastX;
            StartY = lastY;
        }
        isDrawing = false;
        ctx.lineWidth = 2; // Ripristina la larghezza della linea per il disegno
        
    });




    function initializeCanvas() {
        drawSection.style.display = 'flex';
        if (!canvas.getAttribute('data-initialized')) {
            canvas.width = drawSection.offsetWidth;
            canvas.height = drawSection.offsetHeight;
            ctx = canvas.getContext('2d');
            canvas.setAttribute('data-initialized', 'true');
            drawGrid();
            //setupEventListeners();
        }
       
    }

    function updateButtonStyles() {
        const pencilButton = document.getElementById('pencil');
        const dimensionButton = document.getElementById('dimension');
        const eraserToolButton = document.getElementById('eraserTool');

        if (isDrawing) {
            pencilButton.classList.add('button-selected');
            dimensionButton.classList.remove('button-selected');
            eraserToolButton.classList.remove('button-selected');
        } else if (isDimensioning) {
            dimensionButton.classList.add('button-selected');
            pencilButton.classList.remove('button-selected');
            eraserToolButton.classList.remove('button-selected');
        } else if (isErasing) {
            eraserToolButton.classList.add('button-selected');
            pencilButton.classList.remove('button-selected');
            dimensionButton.classList.remove('button-selected');
        } else {
            pencilButton.classList.remove('button-selected');
            dimensionButton.classList.remove('button-selected');
            eraserToolButton.classList.remove('button-selected');
        }
    }

    function clearCanvas() {
        if (!ctx) return; // Verifica che ctx sia definito
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawGrid();
    }

    function setDrawing() {
        isDrawing = true;
        isErasing = false;
        isDimensioning = false;
        ctx.globalCompositeOperation = 'source-over'; // Modalità di disegno normale
        ctx.strokeStyle = '#000000'; // Colore delle linee del disegno
        ctx.lineWidth = 2; // Spessore delle linee
    }

    function drawGrid() {
        if (!ctx) return;
        ctx.strokeStyle = '#eaeaea';
        ctx.lineWidth = 1;
        for (let x = 0; x <= canvas.width; x += gridSize) {
            ctx.beginPath();
            ctx.moveTo(x, 0);
            ctx.lineTo(x, canvas.height);
            ctx.stroke();
        }
        for (let y = 0; y <= canvas.height; y += gridSize) {
            ctx.beginPath();
            ctx.moveTo(0, y);
            ctx.lineTo(canvas.width, y);
            ctx.stroke();
        }
    }

    //commentare
    function draw(e) {
        if (!isDrawing) return;
        e.preventDefault();
    
        let [x, y] = getPosition(e);
        let angle = calculateAngle(StartX, StartY, x, y);
    
        // Aggiornamento del range per la linea obliqua
        if (angle < 20 || angle > 160) {
            drawHorizontalLine(StartY, x);
        } else if (angle >= 20 && angle <= 70 || angle >= 110 && angle <= 160) {
            drawObliqueLineFrom(StartX, StartY, angle);
        } else {
            drawVerticalLine(StartX, y);
        }
    
        // Aggiornamento delle coordinate di partenza per il prossimo segmento
        StartX = x;
        StartY = y;
    }

    function drawLineFromStartToEnd() {
        let angle = calculateAngle(StartX, StartY, lastX, lastY);
        let deltaX = Math.abs(lastX - StartX); // Differenza assoluta in X
    
        let threshold = 10; // Un valore soglia per decidere tra verticale e obliqua
    
        if (angle < 20 || angle > 160 && angle < 200 || angle > 340) {
            drawHorizontalLine(StartY, lastX);
        } else if (deltaX < threshold) {
            // Considera la linea verticale se la differenza in X è minore della soglia
            drawVerticalLine(StartX, lastY);
        } else {
            // Altrimenti, considerala obliqua
            drawObliqueLineFrom(StartX, StartY, lastX, lastY);
        }
    }
    
    let undoStack = [];
    
    function saveState() {
        const canvasState = canvas.toDataURL();
        const inputsState = Array.from(document.querySelectorAll('input[type="text"]:not(.input1):not(.input2)')).map(input => {
            return {
                id: input.id,
                value: input.value,
                position: { left: input.style.left, top: input.style.top }
            };
        });
    
        undoStack.push({ canvasState, inputsState });
    }
    
    function undo() {
        if (undoStack.length > 0) {
            const lastState = undoStack.pop();
            restoreCanvas(lastState.canvasState);
            restoreInputs(lastState.inputsState);
        }
    }
    
    function restoreCanvas(dataUrl) {
        let img = new Image();
        img.onload = function() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(img, 0, 0);
        };
        img.src = dataUrl;
    }

    
    
    
    function restoreInputs(inputsState) {
        // Rimuovi tutte le input-box esistenti
      
        const inputs = document.querySelectorAll('input[type="text"]:not(.input1):not(.input2)');
        inputs.forEach(input => input.remove());
     
        // Ricrea le input-box salvate
        inputsState.forEach(inputState => {
            const container = document.getElementById('drawingCanvasParent'); // Usa il contenitore esterno
            console.log("entro restoreInputs Ricrea")
            const input = document.createElement('input');
            input.type = 'text';
            input.style.position = 'absolute';
            input.style.left = inputState.position.left;
            input.style.top = inputState.position.top;
            input.style.width = '50px';
            input.style.height = '20px';
            input.style.border = '1px solid #ccc';
            input.style.zIndex = '100';
            input.value = inputState.value; // Assicurati di ripristinare il valore
            container.appendChild(input); // Aggiungi al contenitore esterno
        });
    }

    
    function handleResize() {
        if (undoStack.length > 0) {
            const lastState = undoStack[undoStack.length - 1];
            
            // Ritarda il ridisegno per evitare di chiudere la tastiera
            setTimeout(() => {
                restoreCanvas(lastState.canvasState);
                restoreInputs(lastState.inputsState);
                drawGrid();
            }, 500); // Ritardo di 500 ms, ad esempio
        }
    }
    
    
    
    

    function drawLine(ctx, x1, y1, x2, y2) {
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.stroke();
    }

    function getPosition(e) {
        let x, y;
        const rect = canvas.getBoundingClientRect();
    
        if (e.touches && e.touches.length > 0) {
            const touch = e.touches[0];
            x = (touch.clientX - rect.left) * (canvas.width / rect.width);
            y = (touch.clientY - rect.top) * (canvas.height / rect.height);
        } else {
            x = (e.offsetX - rect.left) * (canvas.width / rect.width);
            y = (e.offsetY - rect.top) * (canvas.height / rect.height);
        }
    
        return [x, y];
    }
    
    
    
    

    function calculateAngle(startX, startY, endX, endY) {
        let dy = endY - startY;
        let dx = endX - startX;
        let theta = Math.atan2(dy, dx); // Restituisce un angolo in radianti
        let angle = theta * 180 / Math.PI; // Converti in gradi
        if (angle < 0) {
            angle += 360; // Normalizza l'angolo tra 0 e 360
        }
        return angle;
    }
    


    function drawHorizontalLine(y, xTo) {
        let startX = Math.min(StartX, xTo);
        let endX = Math.max(StartX, xTo);
        
        ctx.beginPath();
        ctx.moveTo(startX, y);
        ctx.lineTo(endX, y);
        ctx.stroke();
    }
    
    function drawVerticalLine(x, yTo) {
        console.log(`drawVerticalLine: StartY = ${StartY}, yTo = ${yTo}`);
    
        let startY = Math.min(StartY, yTo);
        let endY = Math.max(StartY, yTo);
    
        ctx.beginPath();
        ctx.moveTo(x, startY);
        ctx.lineTo(x, endY);
        ctx.stroke();
    }
    
    
    
    function drawObliqueLineFrom(x1, y1, x2, y2) {
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.stroke();
    }


    function startDrawing(x, y) {
        // Reimposta le proprietà di stile per il disegno
        ctx.strokeStyle = '#000000'; // Colore nero per il disegno
        ctx.lineWidth = 2;           // Spessore della linea per il disegno
    
        ctx.beginPath();
        ctx.moveTo(x, y);
    }

    function stopDrawing() {
        // Non reimpostare isDrawing su false qui
        // Così l'utente rimane in modalità disegno dopo aver rilasciato il mouse
        // isDrawing = false; // Commenta o rimuovi questa linea
    }

    function handleTouchStart(e) {
        e.preventDefault();
        [StartX, StartY] = getPosition(e); // Imposta StartX e StartY per il tocco
        
    
        if (isDimensioning) {
            const [x, y] = getPosition(e);
            addInputBox(x, y);
        } else {
            isDrawing = true; // Inizia il disegno
        }
    
        lastX = StartX; // Imposta anche lastX e lastY
        lastY = StartY;
        saveState();
    }

    function addInputBox(x, y) {
        saveState();
        const container = document.getElementById('drawingCanvasParent'); // Usa il contenitore esterno
        const input = document.createElement('input');
        input.type = 'text';
        input.style.position = 'absolute';
        input.style.left = `${x-42}px`; // Posizionamento rispetto al contenitore
        input.style.top = `${y-25}px`;
        input.style.width = '50px';
        input.style.height = '20px';
        input.style.border = '1px solid #ccc';
        input.style.zIndex = '100'; // Assicurati che sia sopra il canvas
        container.appendChild(input); // Aggiungi al contenitore esterno
        console.log("entro addInputBox ")
        
    }

    function removeDimensions() {
        const inputs = document.querySelectorAll('input[type="text"]:not(.input1):not(.input2)');
        inputs.forEach(input => input.remove());
    }



        // Gestione navigazione con tasto Enter
        var inputBoxes = document.querySelectorAll('.input-lato');
        inputBoxes.forEach(function(input, index) {
            input.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault(); // Previene il comportamento di default del tasto Invio
                    // Passa al prossimo input box, se esiste
                    if (index < inputBoxes.length - 1) {
                        inputBoxes[index + 1].focus();
                    }
                }
            });
        });

        //gestion pulsante "carrello"
        var carrello = [];
        document.getElementById('btnAggiungiCarrello').addEventListener('click', function() {
            // Resetta gli stili dei campi in caso siano stati precedentemente marcato come mancanti
            document.querySelectorAll('.campoMancante').forEach(function(campo) {
                campo.classList.remove('campoMancante');
            });
          
        
            var errori = [];
        
            var dropdown1 = document.getElementById('spessore');
            var dropdown2 = document.getElementById('materiale');
            var dropdown3 = document.getElementById('tipologia');
            var dropdown4 = document.getElementById('colore');
            var numPezzi = document.getElementById('numPezzi');
            var altezza = document.getElementById('altezza');
            var tipologiaSelezionata = document.getElementById('tipologia').value;

            // Controlla se la tipologia è "Verniciato" e se almeno una delle opzioni è stata selezionata
            if (tipologiaSelezionata === 'Verniciato') {
                var opzioneSelezionata = document.querySelector('.opzioneVerniciato.selezionata');
        
                if (!opzioneSelezionata) {
                    alert("Seleziona verso verniciatura.");
                    return; // Interrompe ulteriori azioni di questo evento
                }
            }
        
            [dropdown1, dropdown2, dropdown3, dropdown4, numPezzi, altezza].forEach(function(campo) {
                // Controlla se la dropdown è abilitata e se il valore è vuoto
                if (!campo.disabled && !campo.value) {
                    console.log("Campo vuoto trovato:", campo.id);
                    campo.classList.add('campoMancante');
                    errori.push(campo.getAttribute('id'));
                }
            });
        
            // Aggiungi la logica per applicare lo stile al genitore della casella di selezione
            [dropdown1, dropdown2, dropdown3, dropdown4].forEach(function(dropdown) {
                if (!dropdown.disabled && !dropdown.value) {
                    dropdown.parentNode.classList.add('campoMancante');
                }
            });
        
        
            // Controlla e marca le input delle misurazioni se sono vuote
            document.querySelector('.measure-section.' + profiloSelezionato).querySelectorAll('.input-lato').forEach(function(input) {
                if (input.value === '') {
                    input.classList.add('campoMancante');
                    errori.push("misurazione");
                }
            });
        
            if (errori.length > 0) {
                var messaggioErrore = "Per favore, completa i seguenti campi: " + errori.join(", ");
                alert(messaggioErrore);
                return;
            }
            document.querySelectorAll('.input-lato').forEach(function(input) {
                input.style.height = '20px'; // Aumenta l'altezza per la cattura
            });
            // Procedi con il resto del codice per l'aggiunta al carrello
            html2canvas(document.querySelector('.measure-section.' + profiloSelezionato)).then(canvas => {
                var immagineDataUrl = canvas.toDataURL("image/png", 1.0); // Alta qualità
                document.querySelectorAll('.input-lato').forEach(function(input) {
                    input.style.height = ''; // Reimposta all'altezza originale
                });
        
                var datiMisurazioni = {};
                document.querySelector('.measure-section.' + profiloSelezionato).querySelectorAll('.input-lato').forEach(function(input, index) {
                    if (input.value !== '') {
                        datiMisurazioni["Lato" + (index + 1)] = input.value;
                    }
                });
        
                var datiCarrello = {
                    profilo: profiloSelezionato,
                    immagineDataUrl: immagineDataUrl,
                    pezzi: numPezzi.value,
                    altezza: altezza.value,
                    spessore: dropdown1.value,
                    materiale: dropdown2.value,
                    tipologia: dropdown3.value,
                    colore: dropdown4.value,
                    datiMisurazioni: datiMisurazioni
                };
        
                carrello.push(datiCarrello);
                console.log("dati aggiunti: ", carrello);
        
                // Aggiorna il conteggio del carrello e resetta il pulsante e le input box
                document.getElementById('conteggioCarrello').textContent = carrello.length;
                var btn = document.getElementById('btnAggiungiCarrello');
                btn.textContent = 'Aggiunto!';
                setTimeout(function() {
                    btn.textContent = 'Aggiungi al Carrello';
                }, 2000);
        
                // Reset delle input box dopo aver salvato i dati
                document.querySelectorAll('#numPezzi, #altezza').forEach(function(input) {
                    input.value = '';
                });
            });
        });
        
        
        //mostra carrello
        document.getElementById('btnMostraCarrello').addEventListener('click', function() {
            // Nascondi le altre sezioni
            document.getElementById('profile-section').style.display = 'none';
            document.getElementById('input-section').style.display = 'none';
            document.getElementById('measureSection').style.display = 'none';
        
            // Funzione per aggiornare la visualizzazione del carrello
            function aggiornaVisualizzazioneCarrello() {
                var containerElementi = document.getElementById('elementiCarrello');
                containerElementi.innerHTML = ''; // Pulisce vecchi contenuti
        
                carrello.forEach(function(elemento, indice) {
                img = 'img\\' + elemento.immagineDataUrl
                console.log("img: ", img);
                var htmlProfilo = '<div class="elementoCarrello">' +
                    '<img src="'+ elemento.immagineDataUrl + '" alt="Profilo xto" class="imgCarrello">';  
            
        
                var dettagliHtml = '<div class="dettagliProfilo">';
        
                // Aggiungi le misure
                for (var misura in elemento.misurazioni) {
                    dettagliHtml += '<p>' + misura + ': ' + elemento.misurazioni[misura] + '</p>';
                }
        
                 // Aggiungi N. Pezzi e Altezza e altri dettagli
                dettagliHtml += '<p>N. Pezzi: ' + elemento.pezzi + '</p>';
                dettagliHtml += '<p>Altezza: ' + elemento.altezza + '</p>';
                dettagliHtml += '<p>Materiale: ' + elemento.materiale + '</p>';
                dettagliHtml += '<p>Spessore: ' + elemento.spessore + '</p>';
                dettagliHtml += '<p>Tipologia: ' + elemento.tipologia + '</p>';
                dettagliHtml += '<p>Colore: ' + elemento.colore + '</p>';
                dettagliHtml += '</div>'; // Chiusura del contenitore dettagliProfilo

                // Aggiungi un'icona di rimozione
                var iconaRimozioneHtml = '<span class="rimuovi-icona" data-indice="' + indice + '">&#10005;</span>';

                // Aggiungi l'icona di rimozione al profilo HTML
                var htmlProfilo = '<div class="elementoCarrello">' + iconaRimozioneHtml +
                                '<img src="' + elemento.immagineDataUrl + '" alt="Profilo xto" class="imgCarrello">' +
                                dettagliHtml + '</div>';

                containerElementi.innerHTML += htmlProfilo;
            });
        
            // Mostra la sezione del carrello
            document.getElementById('dettagliCarrello').style.display = 'block';

                // Aggiungi event listener per le icone di rimozione
            document.querySelectorAll('.rimuovi-icona').forEach(function(icona) {
                icona.addEventListener('click', function() {
                    var indice = this.getAttribute('data-indice');
                    if (confirm('Confermi la rimozione dell\'elemento dal carrello?')) {
                        carrello.splice(indice, 1);
                        aggiornaVisualizzazioneCarrello(); // Aggiorna nuovamente la visualizzazione del carrello
                        aggiornaBadgeCarrello(); // Aggiorna il badge del carrello
                    }
                });
            });
        }

        // Inizialmente popola la visualizzazione del carrello
        aggiornaVisualizzazioneCarrello();
        aggiornaBadgeCarrello(); // Aggiorna il badge del carrello
    });
        
         // Aggiungi event listener per le icone di rimozione
            document.querySelectorAll('.rimuovi-icona').forEach(function(icona) {
                icona.addEventListener('click', function() {
                    var indice = this.getAttribute('data-indice');
                    if (confirm('Confermi la rimozione dell\'elemento dal carrello?')) {
                        // Rimuovi l'elemento dal carrello
                        carrello.splice(indice, 1);

                        // Aggiorna la visualizzazione del carrello
                        // Qui puoi chiamare nuovamente la funzione di visualizzazione del carrello o aggiornare direttamente il DOM
                    }
                });
            });
       

        function getUrlImmagine(profilo) {
            // Restituisci l'URL dell'immagine in base al nome del profilo
            // Ad esempio:
            return  profilo + '.png'; // Modifica in base alla tua struttura di file
        }
        
        document.getElementById('btnAggiungiElementi').addEventListener('click', function() {
            // Nascondi la sezione del carrello
            document.getElementById('dettagliCarrello').style.display = 'none';
        
            // Mostra le sezioni per aggiungere nuovi elementi
            document.getElementById('profile-section').style.display = 'block';
            document.getElementById('input-section').style.display = 'block';
            document.getElementById('measureSection').style.display = 'block';
            // ... altre sezioni da mostrare se necessario ...
        });
        
        document.getElementById('downloadButton').addEventListener('click', function() {
            // Qui puoi implementare la logica per lo sviluppo o la visualizzazione di ulteriori dettagli
            console.log("downloadButton cliccato");
        });
            


    document.getElementById('downloadButton').addEventListener('click', function() {
        html2canvas(document.getElementById('elementiCarrello')).then(function(canvas) {
            // Converti il canvas in un'immagine
            var image = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
            
            // Crea un elemento di ancoraggio per il download
            var downloadLink = document.createElement('a');
            downloadLink.href = image;
            downloadLink.download = 'immagine.png';
            
            // Simula il clic sull'elemento di ancoraggio
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
        });
    });

    document.getElementById('btnInviaOrdine').addEventListener('click', function() {
        var nomeCliente = document.querySelector('.input1').value;
        var riferimentoOrdine = document.querySelector('.input2').value;
        var oggettoEmail = "Ordine Inventory - " + nomeCliente + " - " + riferimentoOrdine;
        var corpoEmail = "Nuovo Ordine Inventory confermato da " + nomeCliente + ". Dettagli in allegato. Si prega di ricontattare " + nomeCliente + " per conferma lavorazione.";
    
        // Converti il canvas in immagine
       // var canvas = document.querySelector('.measure-section.' + profiloSelezionato + ' canvas');
       // var immagineDataUrl = canvas.toDataURL("image/png");
    
        // Qui devi inviare i dati al tuo server o servizio di email
        // Assicurati che il tuo server gestisca l'invio dell'email con l'immagine allegata
        //inviaEmail(oggettoEmail, corpoEmail, immagineDataUrl);
    
        // Apri il link di condivisione WhatsApp
        apriLinkWhatsApp(nomeCliente,riferimentoOrdine);
    });
    
    function apriLinkWhatsApp(nomeCliente,riferimentoOrdine) {
        var messaggioWhatsApp = encodeURIComponent("Ciao, ti condivido l'ordine che ho effettuato:"+riferimentoOrdine+". Nome Cliente: "+nomeCliente);
        var urlWhatsApp = `https://wa.me/?text=${messaggioWhatsApp}`;
        window.open(urlWhatsApp, '_blank');
    }

    function calcolaVarScalatura(profilo, spessore) {
        switch(profilo) {
            case "omega":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10": return 6;
                    case "15/10": return 7;
                    case "20/10": return 10;
                    case "30/10": return 16;
                    // Aggiungi altri casi per "zeta" qui
                }
                break;
            // Aggiungi altri casi per diversi profili qui
            case "zeta":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10":
                    case "15/10": return 3;
                    case "20/10": return 4;
                    case "30/10": return 6;
                    // Aggiungi altri casi per "zeta" qui
                }
                break;
            case "Ami":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10": return 3;
                    case "15/10": return 6;
                    case "20/10": return 5;
                    case "30/10": return 8;
                    // Aggiungi altri casi per "zeta" qui
                }
            break;   
            case "OmegaInt":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10": return 8;
                    case "15/10": return 10;
                    case "20/10": return 14;
                    case "30/10": return 21;
                    // Aggiungi altri casi per "zeta" qui
                }
            break; 
            case "L":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10": 
                    case "15/10": return 2;
                    case "20/10": return 3;
                    case "30/10": return 5;
                    // Aggiungi altri casi per "zeta" qui
                }
            break;
            case "omega5":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10": return 12;
                    case "15/10": return 14;
                    case "20/10": return 20;
                    case "30/10": return 31;
                    // Aggiungi altri casi per "zeta" qui
                }
            break;
            case "OmegaAsi":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10": return 8;
                    case "15/10": return 12;
                    case "20/10": return 16;
                    case "30/10": return 20;
                    // Aggiungi altri casi per "zeta" qui
                }
            break;
            case "OmegaAsi2":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10":
                    case "15/10": return 8;
                    case "20/10": return 11;
                    case "30/10": return 19;
                    // Aggiungi altri casi per "zeta" qui
                }
            break;
            case "Amo":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10":
                    case "15/10": return 1;
                    case "20/10": return 0;
                    case "30/10": return 3;
                    // Aggiungi altri casi per "zeta" qui
                }
            break;
            case "gancio":
                switch(spessore) {
                    case "6/10":
                    case "8/10":
                    case "10/10":
                    case "12/10": return 4;
                    case "15/10": return 5;
                    case "20/10": return 7;
                    case "30/10": return 11;
                    // Aggiungi altri casi per "zeta" qui
                }
            break;
        }
        return 0; // Restituisci 0 se non viene trovata alcuna corrispondenza
    }
    
    document.getElementById('btnSviluppo').addEventListener('click', function() {
        var nomeCliente = document.querySelector('.input1').value;
        var riferimentoOrdine = document.querySelector('.input2').value;
        var dataOdierna = new Date().toLocaleDateString();
        
            // Ordina il carrello prima di raggrupparlo
        carrello.sort(function(a, b) {
            // Confronta per Materiale
            if (a.materiale < b.materiale) return -1;
            if (a.materiale > b.materiale) return 1;

            // Confronta per Tipologia
            if (a.tipologia < b.tipologia) return -1;
            if (a.tipologia > b.tipologia) return 1;

            // Confronta per Colore
            if (a.colore < b.colore) return -1;
            if (a.colore > b.colore) return 1;

            // Confronta per Spessore
            if (a.spessore < b.spessore) return -1;
            if (a.spessore > b.spessore) return 1;

            return 0; // Se tutti i criteri sono uguali
        });
        // Raggruppa gli elementi per materiale e poi per profilo e misurazioni
        var materialeGruppi = {};

            // Estrai combinazioni uniche
            var combinazioniUniche = {};
            carrello.forEach(function(elemento) {
                var chiaveCombinazione = getElementoChiaveCombinazione(elemento); // Funzione per determinare la chiave
                if (!combinazioniUniche[chiaveCombinazione]) {
                    combinazioniUniche[chiaveCombinazione] = { somma: 0, descrizione: chiaveCombinazione };
                }

                var varScalatura = calcolaVarScalatura(elemento.profilo, elemento.spessore);
                console.log(`varScalatura  ${varScalatura},profilo ${elemento.profilo}, spessore${elemento.spessore} `);
                var sommaMisurazioni = Object.values(elemento.datiMisurazioni).reduce((acc, val) => acc + parseFloat(val), 0);
                sommaMisurazioni = sommaMisurazioni - varScalatura;
                console.log(`sommaMisurazioni  ${sommaMisurazioni}`);
                combinazioniUniche[chiaveCombinazione].somma += elemento.pezzi * elemento.altezza * sommaMisurazioni;
            });

        // Calcola il numero di colonne e righe per la griglia
        var numeroCombinazioni = Object.keys(combinazioniUniche).length;
        var colonne = Math.ceil(Math.sqrt(numeroCombinazioni));
        var righe = Math.ceil(numeroCombinazioni / colonne);
        var pesoTotale = 0;
        var pesiTotaliPerCombinazione = {}; // Nuovo oggetto per tenere traccia del peso totale per ogni combinazione

        carrello.forEach(function(elemento) {
            var materialeFittizio = "MaterialeUnico";
            var chiaveCombinazione = `${elemento.materiale}-${elemento.spessore}`; // Chiave basata su materiale e spessore
            var chiaveProfiloMisurazione = `${materialeFittizio}-${elemento.profilo}-${JSON.stringify(elemento.datiMisurazioni)}-${elemento.materiale}-${elemento.tipologia}-${elemento.spessore}-${elemento.colore || ''}`;

            if (!pesiTotaliPerCombinazione[chiaveCombinazione]) {
                pesiTotaliPerCombinazione[chiaveCombinazione] = 0;
            }
            
            pesiTotaliPerCombinazione[chiaveCombinazione] += calcolaPesoTeorico(elemento.materiale, elemento.spessore);
            console.log(`Aggiornamento peso totale per ${chiaveCombinazione}: ${pesiTotaliPerCombinazione[chiaveCombinazione]}`);

            if (!materialeGruppi[materialeFittizio]) {
                materialeGruppi[materialeFittizio] = {};
            }

            if (!materialeGruppi[materialeFittizio][chiaveProfiloMisurazione]) {
                materialeGruppi[materialeFittizio][chiaveProfiloMisurazione] = {
                    elementi: [],
                    datiMisurazioni: elemento.datiMisurazioni,
                    profilo: elemento.profilo,
                    materiale: elemento.materiale,
                    tipologia: elemento.tipologia,
                    spessore: elemento.spessore,
                    colore: elemento.colore || ''
                };
            }

            materialeGruppi[materialeFittizio][chiaveProfiloMisurazione].elementi.push(elemento);
        });

        // Ora pesiTotaliPerCombinazione conterrà il peso totale per ogni combinazione unica di materiale e spessore
        console.log(pesiTotaliPerCombinazione);
    
        var finestraStampa = window.open('', '_blank');
        if (finestraStampa) {
            finestraStampa.document.write('<html><head><title>Dettagli Ordine</title><style>');
      

            finestraStampa.document.write('.container { border: 1px solid black; width: 210mm; height: 297mm; display: flex; flex-direction: column; align-items: flex-start; justify-content: flex-start; }');
            finestraStampa.document.write('.elemento { display: flex; flex-direction: column; align-items: center; width: 49%; margin: 1px; border: 1px solid black; }'); // Layout in colonna per .elemento
            finestraStampa.document.write('.content { display: flex; flex-direction: row; width: 100%; }'); // Stile per .content
            finestraStampa.document.write('.dettagli-container { display: flex; flex-direction: column; width: 50%;color: red;  font-weight: bold; text-align: end; margin: 12px;}'); // Stile per .dettagli-container
            finestraStampa.document.write('.info-section { width: 100%; text-align: center; border-top: 1px solid gray; color: red;  font-weight: bold;}'); // Stile per .info-section
      
            finestraStampa.document.write('.dettagli { margin: 1px; }'); // Stile per .dettagli
            finestraStampa.document.write('.elemento img { width: 100%; height: auto; max-height: 100%; }'); // Imposta max-height in percentuale
       
          
            
            finestraStampa.document.write('.header-info { display: flex; justify-content: space-between; width: 100%; margin-bottom: 10px; }');
            finestraStampa.document.write('.row { display: flex; width: 100%; justify-content: space-around; flex-wrap: wrap; }');
          
    
            finestraStampa.document.write('</style></head><body>');

            for (var materiale in materialeGruppi) {
                finestraStampa.document.write('<div class="container">');
                finestraStampa.document.write('<div class="header-info" style="font-weight: bold;"><span>Data: ' + dataOdierna + '</span><span>Cliente: ' + nomeCliente + '</span><span>Riferimento Ordine: ' + riferimentoOrdine + '</span></div>');
               

              
    
                var profiliMisurazioniGruppi = materialeGruppi[materiale];
                var elementoContatore = 0;
    
                for (var chiaveProfiloMisurazione in profiliMisurazioniGruppi) {
                    var gruppo = profiliMisurazioniGruppi[chiaveProfiloMisurazione];
                    var percentualeAltezza = 100 / gruppo.elementi.length;
                     // Ordina gli elementi del gruppo per altezza, dal maggiore al minore
                    gruppo.elementi.sort((a, b) => b.altezza - a.altezza);

                    if (elementoContatore % 2 === 0) {
                        finestraStampa.document.write('<div class="row">');
                    }
                    
                    finestraStampa.document.write('<div class="elemento">');
                        finestraStampa.document.write('<div class="content">'); // Nuovo div .content
                        finestraStampa.document.write('<img src="' + gruppo.elementi[0].immagineDataUrl + '" style="width: 50%;">'); // Immagine
                        finestraStampa.document.write('<div class="dettagli-container">'); // Container per i dettagli

                        if (gruppo.materiale === "Alluminio" && gruppo.tipologia === "Verniciato") {
                            var infoSectionContent = `${gruppo.materiale} ${gruppo.colore}`;    
                        } else {
                            var infoSectionContent = `${gruppo.materiale} ${gruppo.spessore} ${gruppo.tipologia} ${gruppo.colore}`;    
                        }
                    
                

                       
                        gruppo.elementi.forEach(function(elemento) {
                            var varScalatura = calcolaVarScalatura(elemento.profilo, elemento.spessore);
                            console.log(`varScalatura  ${varScalatura},profilo ${elemento.profilo}, spessore${elemento.spessore} `);
                            var sommaMisurazioni = Object.values(elemento.datiMisurazioni).reduce((acc, val) => acc + parseFloat(val), 0);
                            sommaMisurazioni = sommaMisurazioni - varScalatura;
                            console.log(`sommaMisurazioni  ${sommaMisurazioni}`);
        
                            finestraStampa.document.write('<div class="dettagli">');
                            finestraStampa.document.write('<p>N.'+elemento.pezzi+' ' + elemento.altezza + ' x ' + sommaMisurazioni + '</p>');
                        
                            finestraStampa.document.write('</div>'); // Chiusura dei div 'dettagli'
                        });
        
                        finestraStampa.document.write('</div>'); // Chiusura di .dettagli-container
                        finestraStampa.document.write('</div>'); // Chiusura di .content
                        finestraStampa.document.write('<div class="info-section">' + infoSectionContent + '</div>');
                        
                        finestraStampa.document.write('</div>'); // Chiusura di .elemento
            
    
                    elementoContatore++;
    
                    if (elementoContatore % 2 === 0 || elementoContatore === Object.keys(profiliMisurazioniGruppi).length) {
                        finestraStampa.document.write('</div>'); // Close the row
                    }
                }
                
                // Aggiungi stile CSS per il footer
                // All'interno della funzione che genera il footer
                finestraStampa.document.write('<div class="footer">');
                    Object.keys(combinazioniUniche).forEach(function(chiaveCombinazione) {
                        console.log(chiaveCombinazione);
                        var parti = chiaveCombinazione.split(' ');
                    
                        var spessore, materiale, tipologia, colore;
                        if (parti.length === 4) {
                            // Ferro o Acciaio
                            [spessore, materiale, tipologia, colore] = parti;
                        } else if (parti.length === 2) {
                            // Alluminio
                            [materiale, colore] = parti;
                            spessore = "12/10"; // Se vuoi usare un valore predefinito
                        }
                    
                        console.log(`Spessore: ${spessore}, Materiale: ${materiale}, Tipologia: ${tipologia}, Colore: ${colore}`);
                        // Resto del codice...
                        var pesoPerMetroQuadro = calcolaPesoTeorico(materiale, spessore);
                        console.log(pesoPerMetroQuadro)
                        var sommaMisurazioni = combinazioniUniche[chiaveCombinazione].somma; // Somma delle misurazioni in cm²
                        console.log(sommaMisurazioni)
                        var pesoFinale = (pesoPerMetroQuadro * sommaMisurazioni)/ 1000000; // Calcola il peso finale
                        pesoFinale = pesoFinale.toFixed(2);
                    
                        finestraStampa.document.write('<div class="footer-cell">' + chiaveCombinazione + ' - Peso teorico: ' + pesoFinale + ' kg</div>');
                    });
                    
                    
                    
                    if (elementoContatore % 2 === 0 || elementoContatore === Object.keys(profiliMisurazioniGruppi).length) {
                        finestraStampa.document.write('</div>'); // Chiudi la riga
                    }
                    finestraStampa.document.write('</div>'); // Chiudi il footer
                    finestraStampa.document.write('<style>');
                    finestraStampa.document.write('.footer { display: grid; grid-template-columns: 1fr 1fr; width: 100%; }');
                    finestraStampa.document.write('.footer-cell { border: 1px solid black; padding: 1px; }');
                    finestraStampa.document.write('</style>');
                    
                    finestraStampa.document.write('</div>'); // Chiudi il contenitore
                    
                
                        
                finestraStampa.document.write('</div>'); // Close the container
            }
               
            finestraStampa.document.write('</body></html>');
            finestraStampa.document.close();
            finestraStampa.focus();
 
            } else {
                console.error('Impossibile aprire la finestra di stampa.');
        }
    });

    document.querySelectorAll('.input-lato').forEach(function(input) {
        input.addEventListener('focus', function() {
            // Resetta il valore dell'input quando riceve il focus
            this.value = '';
        });
    });

    function getElementoChiaveCombinazione(elemento) {
        if (elemento.materiale === "Alluminio" && elemento.tipologia === "Verniciato") {
            return `${elemento.materiale} ${elemento.colore}`;
        } else {
            return `${elemento.spessore} ${elemento.materiale} ${elemento.tipologia} ${elemento.colore}`;
        }
    }

    function calcolaPesoTeorico(materiale, spessore) {
        let pesoPerMetroQuadro;
    
        if (materiale === "Ferro" || materiale === "Acciaio") {
            pesoPerMetroQuadro = 8; // peso in kg per metro quadro
        } else if (materiale === "Alluminio") {
            pesoPerMetroQuadro = 2.834; // peso in kg per metro quadro
        } else {
            return 0; // Valore predefinito per altri materiali
        }
    
        let spessoreInMillimetri = parseInt(spessore.split("/")[0]) / 10;
        return pesoPerMetroQuadro * spessoreInMillimetri; // peso in kg per cm²
    }
    
    
    
    function resetScelteVerniciato() {
        document.querySelectorAll('.scelteVerniciato .opzioneVerniciato').forEach(function(img) {
            img.style.display = 'block'; // Mostra l'immagine
            img.classList.remove('selezionata'); // Rimuovi la selezione
        });
    }

    document.getElementById('tipologia').addEventListener('change', function() {
        var tipologiaSelezionata = this.value;
        var contenitoriScelte = document.querySelectorAll('.scelteVerniciato');
    
        contenitoriScelte.forEach(function(contenitore) {
            if (tipologiaSelezionata === 'Verniciato') {
                contenitore.style.display = 'block'; // Mostra le opzioni per Verniciato
            } else {
                contenitore.style.display = 'none'; // Nascondi le opzioni
            }
        });
    });
    
    document.querySelectorAll('.scelteVerniciato').forEach(function(contenitoreScelte) {
        contenitoreScelte.querySelectorAll('.opzioneVerniciato').forEach(function(img) {
            img.addEventListener('click', function() {
                // Controlla se l'immagine corrente è già selezionata
                var giaSelezionata = this.classList.contains('selezionata');
    
                // Deseleziona e nascondi tutte le immagini nello stesso contenitore
                contenitoreScelte.querySelectorAll('.opzioneVerniciato').forEach(function(i) {
                    i.style.display = 'none'; // Nascondi l'immagine
                    i.classList.remove('selezionata'); // Rimuovi la selezione
                });
    
                if (!giaSelezionata) {
                    // Se l'immagine corrente non era già selezionata, mostrala e selezionala
                    this.style.display = 'block';
                    this.classList.add('selezionata');
                } else {
                    // Se l'immagine corrente era già selezionata, mostra entrambe le opzioni
                    contenitoreScelte.querySelectorAll('.opzioneVerniciato').forEach(function(i) {
                        i.style.display = 'block'; // Mostra l'immagine
                    });
                }
            });
        });
    });
    
  
    
    
        
</script>

</body>

</html>
